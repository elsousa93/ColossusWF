{
    "className": "org.joget.apps.form.model.Form",
    "elements": [{
        "className": "org.joget.apps.form.model.Section",
        "elements": [{
            "className": "org.joget.apps.form.model.Column",
            "elements": [
                {
                    "className": "org.joget.apps.form.lib.HiddenField",
                    "properties": {
                        "id": "servico",
                        "useDefaultWhenEmpty": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.plugin.enterprise.MultiPagedForm",
                    "properties": {
                        "ajaxMode": "",
                        "css": "p {\n    display: inline;\n    position: relative;\n    top: -52px;\n    left: 320px;\n    color: #777!important;\n}\n\ndiv#section-actions {\n    width: 75%;\n    position: relative;\n    top: -121px;\n    left: 250px;\n    padding-bottom: 0px!important;\n}\n\ni.page-button-prev.btn.button.waves-input-wrapper.waves-effect.btn.waves-button.waves-float {\n    background-color: #67a168!important;\n}\n\ni.page-button-next.btn.button.waves-input-wrapper.waves-effect.btn.waves-button.waves-float {\n    background-color: #67a168!important;\n}\n\n.panel.panel-default.formRecordLockContainer {\n    height: 48px!important;\n    margin: 0px!important;\n    padding: 0px!important;\n}\n\n.panel-heading {\n    background-color: #EAEE7A!important;\n}\n\n/* borda_exterior-formulários */ \nbody #form-canvas .form-section {\n  padding-bottom: 100px;\n}\n\nh4.panel-title {\n    color: #777;\n}\n\n.page-container {\n    min-height: 500px;\n}",
                        "displayMode": "wizard",
                        "id": "multiPagedRegistos",
                        "nextButtonlabel": "PRÓXIMO",
                        "numberOfPage": {
                            "className": "4",
                            "properties": {
                                "page1_formDefId": "menuPrincipal2",
                                "page1_label": "Resumo",
                                "page1_parentSubFormId": "detalhe_processo",
                                "page1_readonly": "",
                                "page1_readonlyLabel": "",
                                "page1_subFormParentId": "",
                                "page1_validate": "",
                                "page2_formDefId": "documentos",
                                "page2_label": "Documentos",
                                "page2_parentSubFormId": "documentos",
                                "page2_readonly": "",
                                "page2_readonlyLabel": "",
                                "page2_subFormParentId": "id_processo",
                                "page2_validate": "",
                                "page3_formDefId": "comunicacoes",
                                "page3_label": "Comunicações",
                                "page3_parentSubFormId": "comunicacoes",
                                "page3_readonly": "",
                                "page3_readonlyLabel": "",
                                "page3_subFormParentId": "id_processo",
                                "page3_validate": "",
                                "page4_formDefId": "esclarecimentos",
                                "page4_label": "Diligências",
                                "page4_parentSubFormId": "esclarecimentos",
                                "page4_readonly": "",
                                "page4_readonlyLabel": "",
                                "page4_subFormParentId": "id_processo",
                                "page4_validate": ""
                            }
                        },
                        "onlyAllowSubmitOnLastPage": "",
                        "partiallyStore": "true",
                        "prevButtonlabel": "ANTERIOR",
                        "storeMainFormOnPartiallyStore": "true"
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.CustomHTML",
                    "properties": {
                        "autoPopulate": "",
                        "id": "validacaoErrosCoordenador",
                        "label": "",
                        "permission_rules": {"c0d6089f-5c41-67ce-3c8d-c24ca172207e": {}},
                        "value": "<script type=\"text/javascript\">\n    $(document).ready(function(){\n        \n        $(\"button[name=cancel]\").click(function() {\n            window.sessionStorage.setItem(\"button\", \"null\");\n            window.sessionStorage.setItem(\"previousPage\", \"processo\");\n        });\n        $( \"form\" ).submit(function() {\n            var btnVal = $(document.activeElement).val();\n            \n            if(btnVal === 'GUARDAR'){\n                window.sessionStorage.setItem(\"button\", \"guardar\");\n            }else if( btnVal === \"PROXIMA ATIVIDADE\"){\n                 window.sessionStorage.setItem(\"button\", \"proximaAtividade\");\n                 var assignmentProcessId = \"#assignment.processId#\";\n                 window.sessionStorage.setItem(\"assignmentProcessId\", assignmentProcessId);\n                 var subBanco = \"#variable.sub_banco#\";\n                 //Flag para redirecionar para o Processo\n                 //Caso a atividade atual seja \"Emissão da Carta\" não redireciona para o processo\n                 var flagRedirect = 0;\n                 var activityId = \"#assignment.activityId#\";\n                 if(subBanco !== \"MTG\" || !activityId.includes(\"emissaoCarta\")){\n                     flagRedirect = 1;\n                 }\n                 window.sessionStorage.setItem(\"redirect\", flagRedirect);\n                 \n            }else if(btnVal === \"REALOCAR\"  || btnVal.includes(\"ENVIAR PARA\") || btnVal === \"COLOCAR PENDENTE\"){\n                window.sessionStorage.setItem(\"button\", \"null\");\n            }else {\n                window.sessionStorage.setItem(\"button\", \"tabChange\");\n            }\n        });\n        \n        \n        \n        \n        //console.log(\"#process.activityInst.{assignment.activityDefId}.performer#\");\n        \n\n    });\n    \n    $(window).load(function(){\n        \n        var flag_alerta_alteracoes = \"#form.processos.flag_alerta_alteracoes#\";\n        if(flag_alerta_alteracoes === \"1\"){\n            $(\"input#flag_alerta_alteracoes\").attr(\"value\",\"1\");\n        }\n        var flag_alteracoes = \"#form.processos.flag_alteracoes#\";\n        if(flag_alteracoes === \"NAO\"){\n            $(\"input#flag_alteracoes\").attr(\"value\",\"NAO\");\n        }\n        \n        \n        \n    });\n    \n    \n    window.onload = (event) => {\n        if($(\".form-errors\").text() === \"EXISTEM ERROS DE VALIDAÇÃO\"){\n            if(\"#currentUser.groups.name#\".split(\";\").includes(\"Coordenadores\")){\n                var currentFase = \"#form.detalhe_processo.fase_processo[{form.processos.detalhe_processo}]#\";\n                var proximaFase = \"\";\n                if(currentFase===\"CNT\"){\n                    proximaFase= \"Filtro\";\n                }else if(currentFase===\"FLT\"){\n                    proximaFase = \"Produção Manual\";\n                }else if(currentFase===\"PRD\"){\n                    proximaFase = \"Validação\";\n                }else if(currentFase===\"VAL\"){\n                    proximaFase = \"Conclusões\";\n                }\n                $(\"#filaTrabalho\").append('<table name=\"modalVerificarAlteracoes\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" class=\"boxy-wrapper fixed\" style=\"z-index: 1339; visibility: visible; left: 556.5px; top: 66.012px; opacity: 1;\"><tbody><tr><td class=\"top-left\"><\/td><td class=\"top\"><\/td><td class=\"top-right\"><\/td><\/tr><tr><td class=\"left\"><\/td><td class=\"boxy-inner\"><div class=\"title-bar\"><h2>&nbsp;<\/h2><a href=\"#\" class=\"close\"><i class=\"fa fas fa-times\"><\/i><\/a><\/div><div style=\"width: 650px;height: 450px;\"><span class=\"material-symbols-rounded icone_alerta2\">warning<\/span><div class=\"textValidation\" style=\"width: 100%;height: 450px;text-align: center;vertical-align: middle;line-height: 20px;padding: 180px 0px 0px 0px;font-family: \"Ubuntu\", sans-serif !important;font-size: 18px;\">Existem alguns erros de validação, tem a certeza que pretende continuar?<\/div><div style=\"width: 100%;height: 100px;text-align: center;vertical-align: middle;line-height: 20px;bottom: 0;position: absolute;\"><i class=\"waves-button-input waves-input-wrapper waves-effect btn waves-button waves-float\" style=\"color:rgb(33, 33, 33);background:rgba(0, 0, 0, 0);width: 15%;margin-right: 25%;\"><input id=\"confirmarAlteracoesCoordenador\" name=\"confirmarAlteracoesCoordenador\" class=\"waves-button-input\" type=\"submit\" value=\"SIM\" style=\"background-color:rgba(0,0,0,0);\"><\/i><i class=\"waves-button-input waves-input-wrapper waves-effect btn waves-button waves-float\" style=\"color:rgb(33, 33, 33);background:rgba(0, 0, 0, 0);width: 15%;\"><input id=\"cancelarAlteracoesCoordenador\" name=\"cancelarAlteracoesCoordenador\" class=\"waves-button-input\" type=\"submit\" value=\"NAO\" style=\"background-color:rgba(0,0,0,0);\"><\/i><\/div><\/div><\/td><td class=\"right\"><\/td><\/tr><tr><td class=\"bottom-left\"><\/td><td class=\"bottom\"><\/td><td class=\"bottom-right\"><\/td><\/tr><\/tbody><\/table>');\n                $(\"#filaTrabalho\").append('<div name=\"blackoutEcra\" class=\"boxy-modal-blackout\" style=\"z-index: 1338; opacity: 0.7; width: 100%; height: 100%; position:fixed; top:0px; left:0px;\"><\/div>');\n                var proximaOperativa = $(\"select[id*=envio_processo] option:selected\").val();\n                    //console.log(proximaOperativa);\n                    if(proximaOperativa === ''){\n                        $(\"div.textValidation\").html(\"Existem alguns erros de validação, tem a certeza que pretende continuar?<br>O processo irá avançar para \" + proximaFase);\n                    }\n                $(\"#confirmarAlteracoesCoordenador\").on('click', function() {\n                    var processId = \"#form.processos.id#\";\n                    var subProcessId = \"#process.processId#\";\n                    var activityInstance = \"#process.activityInst.{assignment.activityDefId}.instanceId#\";\n                    var estado = $(\"select[name=multiPaged_2_detalheProcesso_estado_contratacao]\").val();\n                    \n                    if(estado === undefined){\n                        estado = '#form.detalhe_processo.estado_contratacao[{form.processos.detalhe_processo}]#';\n                    }\n                    \n                    var performer = \"#process.activityInst.{assignment.activityDefId}.performer#\";\n                    var laneUser = \"user_\" + performer;\n                    \n                    var complexidade = $(\"select[name=multiPaged_2_detalheProcesso_complex_processo]\").val();\n                    \n                    if(complexidade === undefined){\n                        complexidade = \"#form.detalhe_processo.complex_processo[{form.processos.detalhe_processo}]#\";\n                    }\n                    \n                    if(complexidade === 'COM'){\n                        laneUser += \"_com\";\n                    }\n                    \n                    var apiKey = \"#envVariable.apiKeyAssignments#\";\n                    var apiId = \"#envVariable.apiIdAssignments#\";\n                    \n                    $.ajax({\n                        beforeSend: function(request){\n                            request.setRequestHeader(\"api_key\", apiKey);\n                            request.setRequestHeader(\"api_id\", apiId);\n                        },\n                        type: \"POST\",\n                        dataType: \"json\",\n                        url: \"/jw/api/process/CreditoHabitacao/setActivityVariables/\" + processId + \"/\" + activityInstance + \"?estado=\" + estado + \"&\" + laneUser + \"=#currentUser.username#&proxima_operativa=\" + proximaOperativa, \n                        success: function(data){\n                            $.ajax({\n                                beforeSend: function(request){\n                                    request.setRequestHeader(\"api_key\", apiKey);\n                                    request.setRequestHeader(\"api_id\", apiId);\n                                },\n                                type: \"POST\",\n                                dataType: \"json\",\n                                url: \"/jw/api/process/CreditoHabitacao/completeActivity/\" + subProcessId + \"/\" + activityInstance,\n                                success: function(data){\n                                    window.location = \"#request.scheme#://#request.serverName#:#request.serverPort##request.contextPath#/web/userview/workflowPL/UV_PL_Geral/_/ListaFilaTrabalho\";\n                                }\n                            });\n                        }\n                    });\n                });\n                $(\"#cancelarAlteracoesCoordenador\").on('click', function() {\n                    $(\"table[name=modalVerificarAlteracoes]\").remove();\n                    $(\"div[name=blackoutEcra]\").remove();\n                });\n            }\n        }\n    };\n<\/script>"
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.CustomHTML",
                    "properties": {
                        "autoPopulate": "",
                        "id": "edicao_botoes_default",
                        "label": "",
                        "permission_rules": {"c0d6089f-5c41-67ce-3c8d-c24ca172207e": {}},
                        "value": "<script type=\"text/javascript\">\r\n\r\n\r\n$(function(){\r\n\r\n    $(\"label[field-tooltip=enviar_processo_hidden]\").css(\"display\",\"none\");\r\n    $(\"input[name=enviar_processo_hidden]\").css(\"display\",\"none\");\r\n    \r\n    if($(\"select[name=multiPaged_1_menuPrincipal2_envio_processo] :selected\").val() !== $(\"#enviar_processo_hidden\").val()){\r\n        $(\"select[name=multiPaged_1_menuPrincipal2_envio_processo]\").val($(\"#enviar_processo_hidden\").val() + \"\").change();\r\n    }\r\n    \r\n    /*\r\n    if($(\"select[name=multiPaged_2_detalheProcesso_estado_contratacao]\").val() !== $(\"#enviar_processo_hidden\").val()){\r\n        $(\"select[name=multiPaged_2_detalheProcesso_estado_contratacao]\").val($(\"#enviar_processo_hidden\").val() + \"\").change();\r\n    }*/\r\n    \r\n    var assignmentButton;\r\n    \r\n    nomeBotao();\r\n    \r\n    $(\"select[name=multiPaged_1_menuPrincipal2_envio_processo]\").on('change', function() {\r\n        nomeBotao();\r\n    });\r\n    \r\n    $(\"select[name=multiPaged_2_detalheProcesso_estado_contratacao]\").on('change', function() {\r\n        nomeBotao();\r\n    });\r\n    \r\n    $(window).on('load', function() {\r\n        nomeBotao();\r\n    });\r\n    \r\n    function nomeBotao(){\r\n        var estadoContratacao = $(\"select[name=multiPaged_2_detalheProcesso_estado_contratacao] :selected\").val();\r\n        var envioProcesso = $(\"select[name=multiPaged_1_menuPrincipal2_envio_processo] :selected\").val();\r\n        var flagUltimaAtividade='#variable.flag_ultima_atividade#';\r\n        \r\n        if(estadoContratacao === undefined){\r\n            estadoContratacao = \"#form.detalhe_processo.estado_contratacao[{form.processos.detalhe_processo}]#\";\r\n        }\r\n        \r\n        if(envioProcesso === undefined){\r\n            envioProcesso = \"#form.detalhe_processo.envio_processo[{form.processos.detalhe_processo}]#\";\r\n        }\r\n        \r\n        /*Botão Assignment Complete*/\r\n        if(estadoContratacao == 'PND' || estadoContratacao =='PNDEQ'){\r\n            //assignmentButton = \"COLOCAR PENDENTE\";\r\n            $(\"#assignmentComplete\").hide();\r\n            //$(\"#enviar_processo_hidden\").val(\"PND\");\r\n        }else{\r\n            $(\"#assignmentComplete\").show();\r\n            if(flagUltimaAtividade == 1){\r\n                assignmentButton = \"ENVIAR PARA \";\r\n                if(envioProcesso === \"producao_manual\"){\r\n                    assignmentButton += \"PRODUÇÃO MANUAL\";\r\n                } else if(envioProcesso === \"producao_robot\"){\r\n                    assignmentButton += \"PRODUÇÃO ROBOT\";\r\n                } else{\r\n                    assignmentButton += envioProcesso.toUpperCase();\r\n                }\r\n                \r\n                $(\"#enviar_processo_hidden\").val(envioProcesso);\r\n                \r\n            }else if(flagUltimaAtividade == 2){\r\n                if(envioProcesso === \"contratacao\"){\r\n                    assignmentButton = \"ENVIAR PARA CONTRATAÇÃO\";\r\n                } else{\r\n                    assignmentButton = \"FINALIZAR PROCESSO\";\r\n                }\r\n            }else{\r\n                    assignmentButton = \"PROXIMA ATIVIDADE\";\r\n            }\r\n            $(\"#assignmentComplete\").val(assignmentButton);\r\n        }\r\n        \r\n        /*Botão Guardar*/\r\n        if(estadoContratacao == 'PND' || estadoContratacao == 'PNDEQ'){\r\n            $(\"#saveAsDraft\").val(\"COLOCAR PENDENTE\");\r\n        }else{\r\n            $(\"#saveAsDraft\").val(\"GUARDAR\");\r\n        }\r\n            \r\n        \r\n        \r\n        /*\r\n        if(envioProcesso !== undefined || estadoContratacao !== undefined){\r\n            \r\n            \r\n            \r\n        } else {\r\n            var novoEnvioProcesso = $(\"#enviar_processo_hidden\").val() + \"\";\r\n            if(novoEnvioProcesso === \"PND\"){\r\n                $(\"#assignmentComplete\").val(\"COLOCAR PENDENTE\");\r\n            } else{\r\n                $(\"#assignmentComplete\").val(\"ENVIAR PARA \" + novoEnvioProcesso.toUpperCase());\r\n            }\r\n        }*/\r\n    }\r\n    \r\n    \r\n    $(\"#cancel\").text(\"CANCELAR\"); \r\n    \r\n    /*Hide the Reassign button*/\r\n    var listGroups = '#currentUser.groups.name#';\r\n    if(listGroups.toLowerCase().includes(\"coordenadores\")){\r\n\r\n    }else{\r\n\r\n        $('#process_reassign').parent().hide()\r\n    }\r\n \r\n});\r\n<\/script>"
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.TextField",
                    "properties": {
                        "encryption": "",
                        "id": "enviar_processo_hidden",
                        "label": "enviar_processo_hidden",
                        "maxlength": "",
                        "permissionHidden": "",
                        "permission_rules": {"c0d6089f-5c41-67ce-3c8d-c24ca172207e": {
                            "permissionHidden": "",
                            "readonly": ""
                        }},
                        "placeholder": "",
                        "readonly": "",
                        "readonlyLabel": "",
                        "size": "",
                        "storeNumeric": "",
                        "style": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.HiddenField",
                    "properties": {
                        "id": "saveAsDraftId",
                        "useDefaultWhenEmpty": "",
                        "value": "#requestParam.recordId#",
                        "workflowVariable": ""
                    }
                }
            ],
            "properties": {"width": "100%"}
        }],
        "properties": {
            "comment": "",
            "id": "section1_1",
            "join": "",
            "label": "",
            "loadBinder": {
                "className": "",
                "properties": {}
            },
            "permission": {
                "className": "",
                "properties": {}
            },
            "permissionReadonly": "",
            "readonly": "",
            "readonlyLabel": "",
            "regex": "",
            "reverse": "",
            "storeBinder": {
                "className": "",
                "properties": {}
            },
            "visibilityControl": "",
            "visibilityValue": ""
        }
    }],
    "properties": {
        "description": "",
        "id": "registos",
        "loadBinder": {"className": "org.joget.apps.form.lib.WorkflowFormBinder"},
        "name": "Registos - Processos",
        "storeBinder": {"className": "org.joget.apps.form.lib.WorkflowFormBinder"},
        "tableName": "processos_registos"
    }
}