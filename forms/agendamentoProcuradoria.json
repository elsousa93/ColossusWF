{
    "className": "org.joget.apps.form.model.Form",
    "elements": [
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [
                    {
                        "className": "org.joget.apps.form.lib.HiddenField",
                        "properties": {
                            "id": "flag_agendado",
                            "permission_rules": {
                                "03c775dc-a743-e094-4e35-cf487b91cef2": {},
                                "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {},
                                "2f7e0d1d-ee44-6d46-f4bc-434ed5e08f53": {},
                                "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                                "5173a640-6d7b-ff47-1db9-349049a3ee8f": {},
                                "61eed640-2e15-cba4-8522-d7b5ae130f31": {},
                                "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {},
                                "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                                "7661310a-7dc3-e855-1d82-7f7bb70319c7": {},
                                "7e7faade-f35a-329d-a7a9-b6b63b1bc5b4": {},
                                "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {},
                                "d4230f5d-0b67-d8a3-8845-6d41ad2f225b": {},
                                "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                                "dd84b73a-a59f-28e2-68ab-489586ddeac1": {},
                                "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                            },
                            "useDefaultWhenEmpty": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.HiddenField",
                        "properties": {
                            "id": "id_processo",
                            "permission_rules": {
                                "03c775dc-a743-e094-4e35-cf487b91cef2": {},
                                "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {},
                                "2f7e0d1d-ee44-6d46-f4bc-434ed5e08f53": {},
                                "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                                "5173a640-6d7b-ff47-1db9-349049a3ee8f": {},
                                "61eed640-2e15-cba4-8522-d7b5ae130f31": {},
                                "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {},
                                "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                                "7661310a-7dc3-e855-1d82-7f7bb70319c7": {},
                                "7e7faade-f35a-329d-a7a9-b6b63b1bc5b4": {},
                                "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {},
                                "d4230f5d-0b67-d8a3-8845-6d41ad2f225b": {},
                                "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                                "dd84b73a-a59f-28e2-68ab-489586ddeac1": {},
                                "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                            },
                            "useDefaultWhenEmpty": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.Radio",
                        "properties": {
                            "controlField": "",
                            "id": "urgencia",
                            "label": "Urgência",
                            "options": [
                                {
                                    "grouping": "",
                                    "label": "Sim",
                                    "value": "SIM"
                                },
                                {
                                    "grouping": "",
                                    "label": "Não",
                                    "value": "NAO"
                                }
                            ],
                            "optionsBinder": {
                                "className": "",
                                "properties": {}
                            },
                            "permission_rules": {
                                "03c775dc-a743-e094-4e35-cf487b91cef2": {},
                                "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {},
                                "2f7e0d1d-ee44-6d46-f4bc-434ed5e08f53": {},
                                "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                                "5173a640-6d7b-ff47-1db9-349049a3ee8f": {},
                                "61eed640-2e15-cba4-8522-d7b5ae130f31": {},
                                "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {},
                                "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                                "7661310a-7dc3-e855-1d82-7f7bb70319c7": {},
                                "7e7faade-f35a-329d-a7a9-b6b63b1bc5b4": {},
                                "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {},
                                "d4230f5d-0b67-d8a3-8845-6d41ad2f225b": {},
                                "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                                "dd84b73a-a59f-28e2-68ab-489586ddeac1": {},
                                "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.DatePicker",
                        "properties": {
                            "allowManual": "true",
                            "currentDateAs": "",
                            "dataFormat": "yyyy-MM-dd",
                            "datePickerType": "",
                            "endDateFieldId": "",
                            "format": "",
                            "id": "data_solicitada",
                            "label": "Data Solicitada",
                            "permission_rules": {
                                "03c775dc-a743-e094-4e35-cf487b91cef2": {},
                                "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {},
                                "2f7e0d1d-ee44-6d46-f4bc-434ed5e08f53": {},
                                "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                                "5173a640-6d7b-ff47-1db9-349049a3ee8f": {},
                                "61eed640-2e15-cba4-8522-d7b5ae130f31": {},
                                "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {},
                                "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                                "7661310a-7dc3-e855-1d82-7f7bb70319c7": {},
                                "7e7faade-f35a-329d-a7a9-b6b63b1bc5b4": {},
                                "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {},
                                "d4230f5d-0b67-d8a3-8845-6d41ad2f225b": {},
                                "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                                "dd84b73a-a59f-28e2-68ab-489586ddeac1": {},
                                "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "startDateFieldId": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": "",
                            "yearRange": "c-10:c+10"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.DatePicker",
                        "properties": {
                            "allowManual": "",
                            "datePickerType": "timeOnly",
                            "endDateFieldId": "",
                            "format24hr": "true",
                            "id": "hora_solicitada",
                            "label": "Hora Solicitada",
                            "permission_rules": {
                                "03c775dc-a743-e094-4e35-cf487b91cef2": {},
                                "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {},
                                "2f7e0d1d-ee44-6d46-f4bc-434ed5e08f53": {},
                                "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                                "5173a640-6d7b-ff47-1db9-349049a3ee8f": {},
                                "61eed640-2e15-cba4-8522-d7b5ae130f31": {},
                                "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {},
                                "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                                "7661310a-7dc3-e855-1d82-7f7bb70319c7": {},
                                "7e7faade-f35a-329d-a7a9-b6b63b1bc5b4": {},
                                "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {},
                                "d4230f5d-0b67-d8a3-8845-6d41ad2f225b": {},
                                "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                                "dd84b73a-a59f-28e2-68ab-489586ddeac1": {},
                                "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "startDateFieldId": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "local",
                            "label": "Local",
                            "maxlength": "",
                            "permission_rules": {
                                "03c775dc-a743-e094-4e35-cf487b91cef2": {},
                                "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {},
                                "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                                "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {},
                                "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                                "7661310a-7dc3-e855-1d82-7f7bb70319c7": {},
                                "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {},
                                "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                                "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "morada",
                            "label": "Morada",
                            "maxlength": "",
                            "permission_rules": {
                                "03c775dc-a743-e094-4e35-cf487b91cef2": {},
                                "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {
                                    "permissionHidden": "",
                                    "readonly": ""
                                },
                                "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                                "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {
                                    "permissionHidden": "",
                                    "readonly": ""
                                },
                                "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                                "7661310a-7dc3-e855-1d82-7f7bb70319c7": {
                                    "permissionHidden": "",
                                    "readonly": ""
                                },
                                "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {
                                    "permissionHidden": "",
                                    "readonly": ""
                                },
                                "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                                "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.SelectBox",
                        "properties": {
                            "controlField": "",
                            "id": "distrito",
                            "label": "Distrito",
                            "multiple": "",
                            "options": [],
                            "optionsBinder": {
                                "className": "org.joget.apps.form.lib.FormOptionsBinder",
                                "properties": {
                                    "addEmptyOption": "true",
                                    "cacheInterval": "",
                                    "emptyLabel": "",
                                    "extraCondition": "",
                                    "formDefId": "distritosConcelhos",
                                    "groupingColumn": "",
                                    "idColumn": "distrito",
                                    "labelColumn": "distrito",
                                    "useAjax": ""
                                }
                            },
                            "permission_rules": {
                                "03c775dc-a743-e094-4e35-cf487b91cef2": {},
                                "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "2f7e0d1d-ee44-6d46-f4bc-434ed5e08f53": {},
                                "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "5173a640-6d7b-ff47-1db9-349049a3ee8f": {},
                                "61eed640-2e15-cba4-8522-d7b5ae130f31": {},
                                "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "73d59c6e-5d43-9985-020a-1564a2bd69fd": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "7661310a-7dc3-e855-1d82-7f7bb70319c7": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "7e7faade-f35a-329d-a7a9-b6b63b1bc5b4": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "d4230f5d-0b67-d8a3-8845-6d41ad2f225b": {},
                                "d71cd104-0c18-2072-f92d-82b847d18ab5": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "dd84b73a-a59f-28e2-68ab-489586ddeac1": {},
                                "f05453aa-e857-3dfd-90e1-d657d9b594a5": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                }
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.SelectBox",
                        "properties": {
                            "controlField": "distrito",
                            "id": "concelho",
                            "label": "Concelho",
                            "multiple": "",
                            "options": [],
                            "optionsBinder": {
                                "className": "org.joget.apps.form.lib.FormOptionsBinder",
                                "properties": {
                                    "addEmptyOption": "true",
                                    "cacheInterval": "",
                                    "emptyLabel": "",
                                    "extraCondition": "",
                                    "formDefId": "distritosConcelhos",
                                    "groupingColumn": "distrito",
                                    "idColumn": "concelho",
                                    "labelColumn": "concelho",
                                    "useAjax": "true"
                                }
                            },
                            "permission_rules": {
                                "03c775dc-a743-e094-4e35-cf487b91cef2": {},
                                "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "2f7e0d1d-ee44-6d46-f4bc-434ed5e08f53": {},
                                "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "5173a640-6d7b-ff47-1db9-349049a3ee8f": {},
                                "61eed640-2e15-cba4-8522-d7b5ae130f31": {},
                                "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "73d59c6e-5d43-9985-020a-1564a2bd69fd": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "7661310a-7dc3-e855-1d82-7f7bb70319c7": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "7e7faade-f35a-329d-a7a9-b6b63b1bc5b4": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "d4230f5d-0b67-d8a3-8845-6d41ad2f225b": {},
                                "d71cd104-0c18-2072-f92d-82b847d18ab5": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "dd84b73a-a59f-28e2-68ab-489586ddeac1": {},
                                "f05453aa-e857-3dfd-90e1-d657d9b594a5": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                }
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextArea",
                        "properties": {
                            "cols": "20",
                            "id": "observacoes_agendamento",
                            "label": "Observações do Agendamento",
                            "permission_rules": {
                                "03c775dc-a743-e094-4e35-cf487b91cef2": {},
                                "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {},
                                "2f7e0d1d-ee44-6d46-f4bc-434ed5e08f53": {},
                                "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                                "5173a640-6d7b-ff47-1db9-349049a3ee8f": {},
                                "61eed640-2e15-cba4-8522-d7b5ae130f31": {},
                                "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {},
                                "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                                "7661310a-7dc3-e855-1d82-7f7bb70319c7": {},
                                "7e7faade-f35a-329d-a7a9-b6b63b1bc5b4": {},
                                "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {},
                                "d4230f5d-0b67-d8a3-8845-6d41ad2f225b": {},
                                "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                                "dd84b73a-a59f-28e2-68ab-489586ddeac1": {},
                                "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "rows": "5",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.CustomHTML",
                        "properties": {
                            "autoPopulate": "",
                            "id": "field7",
                            "label": "",
                            "permission_rules": {
                                "03c775dc-a743-e094-4e35-cf487b91cef2": {},
                                "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {},
                                "2f7e0d1d-ee44-6d46-f4bc-434ed5e08f53": {},
                                "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                                "5173a640-6d7b-ff47-1db9-349049a3ee8f": {},
                                "61eed640-2e15-cba4-8522-d7b5ae130f31": {},
                                "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {},
                                "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                                "7661310a-7dc3-e855-1d82-7f7bb70319c7": {},
                                "7e7faade-f35a-329d-a7a9-b6b63b1bc5b4": {},
                                "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {},
                                "d4230f5d-0b67-d8a3-8845-6d41ad2f225b": {},
                                "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                                "dd84b73a-a59f-28e2-68ab-489586ddeac1": {},
                                "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                            },
                            "value": "<script>\nvar flagDesmarcado, local, morada, nprocesso, dataSolicitada, horaSolicitada;\n    $(document).ready(function(){\n        \n        \n        var mode = \"#requestParam._mode#\";\n        //Caso o seja modo de consulta remover o botão de \"Pedir Agendamento\"\n        if(mode!=='assignment'){\n            $(\"input#agendar\").parent().hide();\n        }\n        \n        nprocesso = \"#form.detalhe_proce_procu.n_processo[{form.processos_procu.detalhe_processo}]#\";\n        if($(\"input[id*=flag_agendado]\").val() === '1'){\n            $(\"div[id*=agendamentoProcuradoria_agendamento]\").hide();\n        }\n        \n        local = $(\"input[id*=local]\").val();\n        \n        $(\"input[id*=local]\").change(function(){\n            local = $(\"input[id*=local]\").val();\n            atualizarObservacoes();\n        });\n        \n        morada = $(\"input[id*=morada]\").val();\n        $(\"input[id*=morada]\").change(function(){\n            morada= $(\"input[id*=morada]\").val();\n            atualizarObservacoes();\n        });\n        \n        dataSolicitada=$(\"input[id*=data_solicitada]\").val();\n        $(\"input[id*=data_solicitada]\").change(function(){\n            dataSolicitada=$(\"input[id*=data_solicitada]\").val();\n            atualizarObservacoes();\n        });\n        \n        horaSolicitada=$(\"input[id*=hora_solicitada]\").val();\n        $(\"input[id*=hora_solicitada]\").change(function(){\n            horaSolicitada=$(\"input[id*=hora_solicitada]\").val();\n            atualizarObservacoes();\n        });\n        \n        \n        atualizarObservacoes();\n        $(\"input#agendar\").click(function(){\n            var urgencia = $(\"div[id*=urgencia] input:checked\").val();\n            dataSolicitada=$(\"input[id*=data_solicitada]\").val();\n            horaSolicitada=$(\"input[id*=hora_solicitada]\").val();\n            var observacoes=$(\"textarea[id*=observacoes_agendamento]\").val();\n            var local = $(\"input[id*=local]\").val();\n            var morada = $(\"input[id*=morada]\").val();\n            $.ajax({\n                type:\"POST\",\n                url: \"/jw/api/form/atosAgendamento\",\n                headers:{\n                    \"api_id\": \"#envVariable.apiIdComunicacaoMediaView#\",\n                    \"api_key\": \"#envVariable.apiKeyComunicacaoMediaView#\",\n                    \"Accept\":\"application/json\",\n                    \"Content-Type\": \"application/json\"\n                },\n                data: JSON.stringify({\n                                \"id_processo\": \"#form.processos_procu.id#\",\n                                \"id_agendamento\": \"#form.processos_procu.agendamento#\",\n                                \"urgencia\": 'SIM',\n                                \"data_solicitada\":dataSolicitada,\n                                \"hora_solicitada\":horaSolicitada,\n                                \"local\": local,\n                                \"morada\": morada,\n                                \"observacoes_agendamento\":observacoes,\n                                \"status\": \"AGN\"\n                            }),\n                success: function(response){\n\n                    var id = response.id;\n                    updateEstadoAgendamento();\n                    pedirAgendamento(id);\n                }\n            });\n        });\n        \n        \n        \n        \n        \n    });\n    \n    function atualizarObservacoes(){\n        var observacoesVal = $(\"textarea[id*=observacoes_agendamento]\").val(\"Local: \" + local+ \"\\nMorada: \" + morada + \"\\nData solicitada: \" + dataSolicitada + \" \" + horaSolicitada);    \n        \n    }\n    \n    \n    $(window).load(function(){\n        \n        $(\"a.grid-action-edit\").not(\":last\").click(function(){\n            $('iframe[id*=atos]').on(\"load\", function(){\n                $('iframe[id*=atos]').contents().find(\"body form#atosAgendamento select\").attr(\"disabled\", true);\n                $('iframe[id*=atos]').contents().find(\"form\").on('submit', function(){\n                    $('iframe[id*=atos]').contents().find(\"body form#atosAgendamento select\").attr(\"disabled\", false);\n                });\n                \n            });\n        });\n        \n        $(\"a.grid-action-edit\").click(function(){\n            $('iframe[id*=atos]').on(\"load\", function(){\n                if($('iframe[id*=atos]').contents().find(\"select[id*=status]\").val().includes('DES')){\n                    $('iframe[id*=atos]').contents().find(\"select[id*=motivo_desmarcacao]\").parent().show();\n                }else{\n                    $('iframe[id*=atos]').contents().find(\"select[id*=motivo_desmarcacao]\").val(\"\");    \n                    $('iframe[id*=atos]').contents().find(\"select[id*=motivo_desmarcacao]\").parent().hide();\n                }\n            });\n        });\n    });\n    \n    $(document).change(function(){\n        var status = FormUtil.getValues(\"atos.status\");\n        var flagAGN = false;\n        flagDesmarcado = false;\n        \n        \n        if(status.length>0){\n            //Se existir atos Desmarcados\n            if(status[status.length-1].indexOf('DES') !== -1 || status[status.length-1].indexOf('NOUT') !== -1){\n                flagDesmarcado = true;\n            }\n        }\n        \n            //Caso não existam atos desmarcados ou não haja nenhum pedido de agendamento\n            if(!flagDesmarcado || $(\"input[id*=flag_agendado]\").val() === '0'){\n                $(\"div[id*=mensagemAgendamento]\").hide();\n            }else{\n                $(\"div[id*=mensagemAgendamento]\").show();\n            }\n \n        \n    });\n    \n\n    \n    \nfunction updateEstadoAgendamento(){\n    \n        $.ajax({\n                type:\"POST\",\n                url: \"/jw/api/form/agendamentoProcuradoria/saveOrUpdate\",\n                headers:{\n                    \"api_id\": \"#envVariable.apiIdComunicacaoMediaView#\",\n                    \"api_key\": \"#envVariable.apiKeyComunicacaoMediaView#\",\n                    \"accept\":\"application/json\",\n                    \"Content-Type\": \"application/json\"\n                },\n                data: JSON.stringify({\n                                \"id\": \"#form.processos_procu.agendamento#\",\n                                \"flag_agendado\": \"1\"\n                            }),\n                success: function(data){\n                    $.ajax({\n                        type:\"POST\",\n                        url: \"/jw/api/form/detalheProcessoProcuradoria/saveOrUpdate\",\n                        headers:{\n                            \"api_id\": \"#envVariable.apiIdAtualizarCampos#\",\n                            \"api_key\": \"#envVariable.apiKeyAtualizarCampos#\",\n                            \"accept\":\"application/json\",\n                            \"Content-Type\": \"application/json\"\n                        },\n                        data: JSON.stringify({\n                                    \"id\": \"#form.processos_procu.detalhe_proce_procu#\",\n                                    \"estado\": \"EAGN\"\n                                }),\n                        success: function(data){\n                            location.reload();\n                        }\n                    });\n                }\n            });\n    }\n    \nfunction pedirAgendamento(idRegisto){\n        //Banco\n        var banco = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\n        var bancoMediaView = \"\";\n        switch(banco){\n            case \"BCP\":\n                bancoMediaView = \"BCP\";\n                break;\n            case \"BNI\":\n                bancoMediaView = \"BNI\";\n                break;\n            case \"BIC\":\n                bancoMediaView = \"BIC\";\n                break;\n            case \"HPG\":\n                bancoMediaView = \"HIPO\";\n                break;\n            case \"MTG\":\n                bancoMediaView = \"MTP\";\n                break;\n            case \"NOR\":\n                bancoMediaView = \"NORF\";\n                break;\n            case \"WHS\":\n                bancoMediaView = \"WHITS\";\n                break;\n            default:\n                bancoMediaView = \"\";  //Falta sem banco\n                break;\n        }\n        \n        //Data e Hora Solicitada\n        var dataSolicitada = $(\"input[id*= data_solicitada]\").val();\n        var horaSolicitada = $(\"input[id*=hora_solicitada]\").val() + \":00\";\n        dataSolicitada = dataSolicitada.substring(6,10) + \"-\" + dataSolicitada.substring(3,5) + \"-\" + dataSolicitada.substring(0,2);\n        var dataSolicitada = dataSolicitada +\"T\" +horaSolicitada;\n        \n\n        //Observações\n        var observacoes =  $(\"textarea[id*=observacoes_agendamento]\").val();\n        \n        \n        \n        //Pedir Agendamento\n        var username = \"#envVariable.apiMediaViewUsername#\";\n        var password = \"#envVariable.apiMediaViewPassword#\";\n        \n        var xmlhttp = new XMLHttpRequest();\n        //xmlhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded; charset=ISO-8859-1');\n        \n        xmlhttp.open('POST', 'https://www.plataformalegal.pt/qualdesign/rpts/workflow.asmx?wsdl', true);\n        xmlhttp.setRequestHeader('Content-Type', 'text/xml; charset=UTF-8');\n        xmlhttp.onreadystatechange = function () {\n            if (xmlhttp.readyState == 4) {\n                if (xmlhttp.status == 200) {\n                    var xmlResponse = $.parseXML(xmlhttp.responseText);\n                    var result = $(xmlResponse).find(\"EnviarProcessoResult\").text();\n                    console.log(xmlResponse);\n                    console.log(result);\n                    //location.reload();\n                }\n            }\n        }\n        //+tipoDeProcesso\n        \n        \n        \n        var sr= `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n                <soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">\n                  <soap:Header>\n                    <Header xmlns=\"http://tempuri.org/\">\n                      <Username>`+username+`<\/Username>\n                      <Password>`+password+`<\/Password>\n                    <\/Header>\n                  <\/soap:Header>\n                  <soap:Body>\n                    <EnviarProcesso xmlns=\"http://tempuri.org/\">\n                      <processo>\n                        <IdRegisto>`+idRegisto+`<\/IdRegisto>\n                        <NWF>`+nprocesso+`<\/NWF>\n                        <Banco>`+bancoMediaView+`<\/Banco>\n                        <DataIndicativa>`+dataSolicitada+`<\/DataIndicativa>\n                        <Observacoes>`+observacoes+`<\/Observacoes>\n                      <\/processo>\n                    <\/EnviarProcesso>\n                  <\/soap:Body>\n                <\/soap:Envelope>`;\n        \n        console.log(sr);\n        xmlhttp.send(sr);\n}    \n \n    \n<\/script>\n<input id=\"agendar\" type=\"button\" value=\"PEDIR AGENDAMENTO\">"
                        }
                    }
                ],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "comment": "",
                "id": "agendamento_1",
                "join": "",
                "label": "Pedido de Agendamento",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "permission_rules": {
                    "03c775dc-a743-e094-4e35-cf487b91cef2": {},
                    "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {},
                    "2f7e0d1d-ee44-6d46-f4bc-434ed5e08f53": {},
                    "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                    "5173a640-6d7b-ff47-1db9-349049a3ee8f": {},
                    "61eed640-2e15-cba4-8522-d7b5ae130f31": {},
                    "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {},
                    "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                    "7661310a-7dc3-e855-1d82-7f7bb70319c7": {},
                    "7e7faade-f35a-329d-a7a9-b6b63b1bc5b4": {},
                    "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {},
                    "d4230f5d-0b67-d8a3-8845-6d41ad2f225b": {},
                    "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                    "dd84b73a-a59f-28e2-68ab-489586ddeac1": {},
                    "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                },
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [
                    {
                        "className": "org.joget.apps.form.lib.CustomHTML",
                        "properties": {
                            "autoPopulate": "",
                            "id": "field8",
                            "label": "",
                            "permission_rules": {
                                "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {},
                                "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                                "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {},
                                "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                                "7661310a-7dc3-e855-1d82-7f7bb70319c7": {},
                                "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {},
                                "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                                "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                            },
                            "value": "<div>\n    \n<\/div>"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.CustomHTML",
                        "properties": {
                            "autoPopulate": "",
                            "id": "field8",
                            "label": "",
                            "permission_rules": {
                                "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {},
                                "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                                "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {},
                                "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                                "7661310a-7dc3-e855-1d82-7f7bb70319c7": {},
                                "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {},
                                "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                                "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                            },
                            "value": "<script>\n$(document).ready(function(){\n    \n    $(\"input#novoagendamento\").click(function(){\n        resetEstadoAgendamento();\n    });\n    \n    \n});\n\nfunction resetEstadoAgendamento(){\n            $.ajax({\n                type:\"POST\",\n                url: \"/jw/api/form/agendamentoProcuradoria/saveOrUpdate\",\n                headers:{\n                    \"api_id\": \"#envVariable.apiIdComunicacaoMediaView#\",\n                    \"api_key\": \"#envVariable.apiKeyComunicacaoMediaView#\",\n                    \"accept\":\"application/json\",\n                    \"Content-Type\": \"application/json\"\n                },\n                data: JSON.stringify({\n                                \"id\": \"#form.processos_procu.agendamento#\",\n                                \"flag_agendado\": \"0\"\n                            }),\n                success: function(data){\n                    var idAtos = FormUtil.getValues(\"atos.id\");\n                    if(idAtos.length>0){\n                        var motivoDesmarcacao = FormUtil.getValues(\"atos.motivo_desmarcacao\");\n                        var status = FormUtil.getValues(\"atos.status\");\n                        \n                        for(i=0; i<idAtos.length; i++){\n                            \n                            updateAto(idAtos[i],motivoDesmarcacao[i], status[i]);\n                        }\n                    }\n                    location.reload();\n                }\n            });\n}\n\nfunction updateAto(id, motivoDesmarcacao, status){\n    \n    $.ajax({\n        type:\"POST\",\n        url: \"/jw/api/form/atosAgendamento/saveOrUpdate\",\n        headers:{\n            \"api_id\": \"#envVariable.apiIdComunicacaoMediaView#\",\n            \"api_key\": \"#envVariable.apiKeyComunicacaoMediaView#\",\n            \"Accept\":\"application/json\",\n            \"Content-Type\": \"application/json\"\n        },\n        data: JSON.stringify({\n                        \"id\": id,\n                        \"status\": status,\n                        \"motivo_desmarcacao\": motivoDesmarcacao\n                    }),\n        success: function(response){\n            \n        }\n    });\n    \n    \n    \n    \n}\n    \n<\/script>\n<input id=\"novoagendamento\" type=\"button\" value=\"PEDIR NOVO AGENDAMENTO\">"
                        }
                    }
                ],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "comment": "",
                "id": "mensagemAgendamento",
                "join": "",
                "label": "Agendamento",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "permission_rules": {
                    "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {},
                    "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                    "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {},
                    "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                    "7661310a-7dc3-e855-1d82-7f7bb70319c7": {},
                    "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {},
                    "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                    "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                },
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [{
                    "className": "org.joget.plugin.enterprise.FormGrid",
                    "properties": {
                        "abortRelatedRunningProcesses": "",
                        "deleteFiles": "",
                        "deleteGridData": "",
                        "deleteMessage": "Delete row?",
                        "deleteSubformData": "",
                        "disabledAdd": "true",
                        "disabledDelete": "true",
                        "enableSorting": "",
                        "errorMessage": "Invalid number of rows",
                        "formDefId": "atosAgendamento",
                        "height": "85%",
                        "id": "atos",
                        "label": "Atos",
                        "loadBinder": {
                            "className": "org.joget.plugin.enterprise.MultirowFormBinder",
                            "properties": {
                                "foreignKey": "id_agendamento",
                                "formDefId": "atosAgendamento"
                            }
                        },
                        "options": [
                            {
                                "format": "opcoesDisplayGrid",
                                "formatType": "options",
                                "label": "Status",
                                "value": "status",
                                "width": ""
                            },
                            {
                                "format": "",
                                "formatType": "text",
                                "label": "Data Outorga",
                                "value": "dataOutorga",
                                "width": ""
                            },
                            {
                                "format": "",
                                "formatType": "text",
                                "label": "Hora Outorga",
                                "value": "horaOutorga",
                                "width": ""
                            },
                            {
                                "format": "",
                                "formatType": "text",
                                "label": "Procurador",
                                "value": "procurador",
                                "width": ""
                            }
                        ],
                        "pageSize": "20",
                        "permissionHidden": "",
                        "permission_rules": {
                            "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {},
                            "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                            "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {},
                            "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                            "7661310a-7dc3-e855-1d82-7f7bb70319c7": {},
                            "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {},
                            "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                            "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                        },
                        "readonly": "",
                        "readonlyLabel": "",
                        "showRowNumber": "",
                        "storeBinder": {
                            "className": "org.joget.plugin.enterprise.MultirowFormBinder",
                            "properties": {
                                "foreignKey": "id_agendamento",
                                "formDefId": "atosAgendamento"
                            }
                        },
                        "submit-label-normal": "",
                        "submit-label-readonly": "",
                        "uniqueKey": "",
                        "validateMaxRow": "",
                        "validateMinRow": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "width": "85%"
                    }
                }],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "comment": "",
                "id": "section2",
                "join": "",
                "label": "Atos",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "permission_rules": {
                    "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9": {},
                    "4ca43afb-7ca5-9595-7d5e-480f9e1269aa": {},
                    "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1": {},
                    "73d59c6e-5d43-9985-020a-1564a2bd69fd": {},
                    "7661310a-7dc3-e855-1d82-7f7bb70319c7": {},
                    "8d26fcff-b200-5ba6-a36b-6bf75f33839e": {},
                    "d71cd104-0c18-2072-f92d-82b847d18ab5": {},
                    "f05453aa-e857-3dfd-90e1-d657d9b594a5": {}
                },
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        }
    ],
    "properties": {
        "description": "",
        "id": "agendamentoProcuradoria",
        "loadBinder": {
            "className": "org.joget.apps.form.lib.WorkflowFormBinder",
            "properties": {}
        },
        "name": "Procuradoria - Agendamento",
        "noPermissionMessage": "",
        "permission": {
            "className": "",
            "properties": {}
        },
        "permission_rules": [
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"MTG\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "73d59c6e-5d43-9985-020a-1564a2bd69fd",
                "permission_name": "MTG"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"BIC\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "f05453aa-e857-3dfd-90e1-d657d9b594a5",
                "permission_name": "BIC"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"BNI\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "d71cd104-0c18-2072-f92d-82b847d18ab5",
                "permission_name": "BNI"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"BCP\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "4ca43afb-7ca5-9595-7d5e-480f9e1269aa",
                "permission_name": "BCP"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"HPG\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "6fb83d36-30a3-de4b-f6ee-475a1d3c4ee1",
                "permission_name": "Hipoges (HPG)"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"NOR\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "7661310a-7dc3-e855-1d82-7f7bb70319c7",
                "permission_name": "Norfin (NOR)"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"DHM\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "1fa5eef4-6607-58b1-6a12-e2ed8ae717c9",
                "permission_name": "DHM"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"WHS\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "8d26fcff-b200-5ba6-a36b-6bf75f33839e",
                "permission_name": "Whitestar (WHS)"
            }
        ],
        "postProcessor": {
            "className": "",
            "properties": {}
        },
        "postProcessorRunOn": "create",
        "storeBinder": {
            "className": "org.joget.apps.form.lib.WorkflowFormBinder",
            "properties": {}
        },
        "tableName": "agendamento_procu"
    }
}