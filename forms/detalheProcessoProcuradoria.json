{
    "className": "org.joget.apps.form.model.Form",
    "elements": [{
        "className": "org.joget.apps.form.model.Section",
        "elements": [{
            "className": "org.joget.apps.form.model.Column",
            "elements": [
                {
                    "className": "org.joget.apps.form.lib.HiddenField",
                    "properties": {
                        "id": "id_processo",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                            "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                            "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                            "787c67d4-d157-ca8e-655e-43717638627d": {},
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                            "e94738b9-1966-5300-3072-703d03acb3df": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {},
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                        },
                        "useDefaultWhenEmpty": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.HiddenField",
                    "properties": {
                        "id": "user_alerta",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                            "787c67d4-d157-ca8e-655e-43717638627d": {},
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {},
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                        },
                        "useDefaultWhenEmpty": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.HiddenField",
                    "properties": {
                        "id": "data_alerta",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                            "787c67d4-d157-ca8e-655e-43717638627d": {},
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {},
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                        },
                        "useDefaultWhenEmpty": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.TextField",
                    "properties": {
                        "encryption": "",
                        "id": "n_processo",
                        "label": "Número do Processo",
                        "maxlength": "",
                        "permissionHidden": "",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                            "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                            "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "787c67d4-d157-ca8e-655e-43717638627d": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                            "e94738b9-1966-5300-3072-703d03acb3df": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {
                                "permissionHidden": "",
                                "readonly": "true"
                            }
                        },
                        "placeholder": "",
                        "readonly": "true",
                        "readonlyLabel": "",
                        "size": "",
                        "storeNumeric": "",
                        "style": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.TextField",
                    "properties": {
                        "encryption": "",
                        "id": "n_agenda",
                        "label": "Número Workflow PL",
                        "maxlength": "",
                        "permissionHidden": "",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "787c67d4-d157-ca8e-655e-43717638627d": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "ee177599-9c69-d878-10f8-9aebde208e06": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {
                                "permissionHidden": "",
                                "readonly": "true"
                            }
                        },
                        "placeholder": "",
                        "readonly": "true",
                        "readonlyLabel": "",
                        "size": "",
                        "storeNumeric": "",
                        "style": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.SelectBox",
                    "properties": {
                        "controlField": "",
                        "id": "banco_fundo",
                        "label": "Banco/Fundo",
                        "multiple": "",
                        "options": [],
                        "optionsBinder": {
                            "className": "org.joget.apps.form.lib.FormOptionsBinder",
                            "properties": {
                                "addEmptyOption": "true",
                                "cacheInterval": "",
                                "emptyLabel": "",
                                "extraCondition": "c_nome_campo = 'nome_banco' AND e.customProperties.servico LIKE '%PROCU%'",
                                "formDefId": "adicionarOpcaoLV",
                                "groupingColumn": "",
                                "idColumn": "value",
                                "labelColumn": "label",
                                "useAjax": ""
                            }
                        },
                        "permissionHidden": "",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                            "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                            "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "787c67d4-d157-ca8e-655e-43717638627d": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                            "e94738b9-1966-5300-3072-703d03acb3df": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {
                                "permissionHidden": "",
                                "readonly": "true"
                            }
                        },
                        "readonly": "true",
                        "readonlyLabel": "",
                        "size": "",
                        "validator": {
                            "className": "org.joget.apps.form.lib.DefaultValidator",
                            "properties": {
                                "mandatory": "true",
                                "message": "#i18n.mandatorymsg#",
                                "type": ""
                            }
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.DatePicker",
                    "properties": {
                        "allowManual": "",
                        "currentDateAs": "",
                        "dataFormat": "yyyy-MM-dd",
                        "datePickerType": "dateTime",
                        "endDateFieldId": "",
                        "format": "dd/mm/yy",
                        "format24hr": "true",
                        "id": "data_primeira_entrada",
                        "label": "Data de Primeira Entrada",
                        "permissionHidden": "",
                        "permission_rules": {
                            "04d94e96-37aa-1e4b-d5fe-5595f325e232": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "1fb8f1eb-7717-2af5-ccf1-03a73c560f16": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "504595d7-fa4b-d219-d8a6-65d1a4da0728": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "6c9a9c6d-bd10-4f4a-0682-541bcbb1222b": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "787c67d4-d157-ca8e-655e-43717638627d": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "966fc1ca-d0b8-439f-6ab3-76cf9a599c75": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "9f700b46-bde2-cc69-98a7-c562c400ad6d": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "9fb8a08a-3747-1f8e-48ac-fff77f61d611": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "aa6ccea8-6e7f-1433-8d14-32132e9bf1e0": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "d07f81ea-a80c-4560-01fd-7772c1762b0f": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "d6fe0da9-3aa3-9d28-ded2-07a6fb980292": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "e94738b9-1966-5300-3072-703d03acb3df": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "ee177599-9c69-d878-10f8-9aebde208e06": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "f6d47cc6-84dc-c359-9ec5-794a6dcbf118": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {
                                "permissionHidden": "",
                                "readonly": "true"
                            }
                        },
                        "placeholder": "",
                        "readonly": "true",
                        "readonlyLabel": "",
                        "startDateFieldId": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": "",
                        "yearRange": "c-10:c"
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.DatePicker",
                    "properties": {
                        "allowManual": "true",
                        "currentDateAs": "",
                        "dataFormat": "yyyy-MM-dd",
                        "datePickerType": "dateTime",
                        "endDateFieldId": "",
                        "format": "dd/mm/yy",
                        "format24hr": "true",
                        "id": "data_entrada",
                        "label": "Data de Última Entrada",
                        "permission_rules": {
                            "04d94e96-37aa-1e4b-d5fe-5595f325e232": {},
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                            "1fb8f1eb-7717-2af5-ccf1-03a73c560f16": {},
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                            "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                            "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                            "6c9a9c6d-bd10-4f4a-0682-541bcbb1222b": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                            "787c67d4-d157-ca8e-655e-43717638627d": {},
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                            "966fc1ca-d0b8-439f-6ab3-76cf9a599c75": {},
                            "9f700b46-bde2-cc69-98a7-c562c400ad6d": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "9fb8a08a-3747-1f8e-48ac-fff77f61d611": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "aa6ccea8-6e7f-1433-8d14-32132e9bf1e0": {
                                "permissionHidden": "",
                                "readonly": ""
                            },
                            "d07f81ea-a80c-4560-01fd-7772c1762b0f": {},
                            "d6fe0da9-3aa3-9d28-ded2-07a6fb980292": {},
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                            "e94738b9-1966-5300-3072-703d03acb3df": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {},
                            "f6d47cc6-84dc-c359-9ec5-794a6dcbf118": {},
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                        },
                        "placeholder": "",
                        "readonly": "",
                        "readonlyLabel": "",
                        "startDateFieldId": "",
                        "validator": {
                            "className": "org.joget.apps.form.lib.BeanShellValidator",
                            "properties": {
                                "decoration": "*",
                                "script": "import java.util.Arrays;\r\nimport org.joget.apps.app.service.AppUtil;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.model.Form;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.apps.form.service.FormUtil;\r\nimport org.joget.commons.util.LogUtil;\r\nimport java.sql.Connection;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport javax.sql.DataSource;\r\nimport org.joget.apps.app.model.AppDefinition;\r\n  \r\npublic boolean validate(Element element, FormData formData, String[] fileUploadValues){\r\n    \r\n\r\n    \r\n    boolean result = true;\r\n\r\n    Connection con = null;\r\n    PreparedStatement stmt = null;\r\n    ResultSet rs = null;\r\n    \r\n    AppDefinition appDef = AppUtil.getCurrentAppDefinition();\r\n    \r\n    \r\n    try{\r\n            DataSource ds = (DataSource)AppUtil.getApplicationContext().getBean(\"setupDataSource\");\r\n            con = ds.getConnection();\r\n            \r\n            if(!con.isClosed()){\r\n                \r\n                \r\n                String idProcesso = \"#form.processos_procu.id#\";\r\n                String idSubProcesso = \"#assignment.processId#\";\r\n                \r\n                \r\n                //Validar apenas se existir um SLA 'Em curso'\r\n                String queryGetLastSLA = \"SELECT * FROM app_fd_sla_atividade WHERE c_id_processo = ? AND c_estado_atividade = 'Em curso';\";\r\n                stmt = con.prepareStatement(queryGetLastSLA);\r\n                stmt.setObject(1, idSubProcesso);\r\n                rs = stmt.executeQuery();\r\n                if(rs.next()){\r\n                    \r\n                    //Configure field to validate - UPDATE HERE\r\n                    String fieldId = \"data_entrada\";\r\n                    \r\n                    //Get element value\r\n                    Form form = FormUtil.findRootForm(element);\r\n                    Element field = FormUtil.findElement(fieldId, form, formData);\r\n                    String fieldValue = FormUtil.getElementPropertyValue(field, formData);\r\n                    \r\n                    //If element is not filled give error message\r\n                    if (fieldValue == null || fieldValue.equals(\"\")){\r\n                        String id = FormUtil.getElementParameterName(element);\r\n                        formData.addFormError(id, \"Campo obrigatório\");\r\n                        result = false;\r\n                    }else{\r\n                        result = true;\r\n                    }\r\n                         \r\n                }\r\n            }\r\n            \r\n    }catch(Exception e){\r\n        LogUtil.error(appDef.toString(), e, \"Error getting info from DB\");\r\n    }finally{\r\n        try{\r\n            if(rs != null){\r\n            rs.close();\r\n            }\r\n            if(stmt != null){\r\n                stmt.close();\r\n            }\r\n            if(con != null && !con.isClosed()) {\r\n                con.close();\r\n            }\r\n        }catch(Exception e){\r\n            LogUtil.error(appDef.toString(), e, \"Error closing DB connection\");\r\n        }\r\n    }\r\n\r\n    return result;\r\n\r\n}\r\n\r\n//call validate method with injected variable\r\nreturn validate(element, formData, values);"
                            }
                        },
                        "value": "",
                        "workflowVariable": "",
                        "yearRange": "c-10:c"
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.DatePicker",
                    "properties": {
                        "allowManual": "",
                        "currentDateAs": "",
                        "dataFormat": "",
                        "datePickerType": "dateTime",
                        "endDateFieldId": "",
                        "format": "",
                        "format24hr": "true",
                        "id": "dateCreated",
                        "label": "Data de Criação",
                        "permissionHidden": "",
                        "permission_rules": {
                            "04d94e96-37aa-1e4b-d5fe-5595f325e232": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "1fb8f1eb-7717-2af5-ccf1-03a73c560f16": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "504595d7-fa4b-d219-d8a6-65d1a4da0728": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "6c9a9c6d-bd10-4f4a-0682-541bcbb1222b": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "787c67d4-d157-ca8e-655e-43717638627d": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "966fc1ca-d0b8-439f-6ab3-76cf9a599c75": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "9f700b46-bde2-cc69-98a7-c562c400ad6d": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "9fb8a08a-3747-1f8e-48ac-fff77f61d611": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "aa6ccea8-6e7f-1433-8d14-32132e9bf1e0": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "d07f81ea-a80c-4560-01fd-7772c1762b0f": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "d6fe0da9-3aa3-9d28-ded2-07a6fb980292": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "e94738b9-1966-5300-3072-703d03acb3df": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "ee177599-9c69-d878-10f8-9aebde208e06": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "f6d47cc6-84dc-c359-9ec5-794a6dcbf118": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {
                                "permissionHidden": "",
                                "readonly": "true"
                            }
                        },
                        "placeholder": "",
                        "readonly": "true",
                        "readonlyLabel": "",
                        "startDateFieldId": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": "",
                        "yearRange": "c-10:c+10"
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.TextField",
                    "properties": {
                        "encryption": "",
                        "id": "n_comservice",
                        "label": "Nº Comservice",
                        "maxlength": "",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "787c67d4-d157-ca8e-655e-43717638627d": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "ee177599-9c69-d878-10f8-9aebde208e06": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {
                                "permissionHidden": "true",
                                "readonly": ""
                            }
                        },
                        "placeholder": "",
                        "readonly": "",
                        "readonlyLabel": "",
                        "size": "",
                        "storeNumeric": "",
                        "style": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.SelectBox",
                    "properties": {
                        "controlField": "banco_fundo",
                        "id": "tipo_processo",
                        "label": "Tipo de processo",
                        "multiple": "",
                        "options": [],
                        "optionsBinder": {
                            "className": "org.joget.apps.form.lib.BeanShellFormBinder",
                            "properties": {
                                "cacheInterval": "",
                                "script": "import org.joget.apps.app.service.AppUtil;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.apps.form.model.FormRow;\r\nimport org.joget.apps.form.model.FormRowSet;\r\nimport org.joget.apps.form.model.FormStoreBinder;\r\nimport java.sql.Connection;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport javax.sql.DataSource;\r\nimport org.joget.apps.form.service.FormUtil;\r\nimport org.joget.apps.app.model.AppDefinition;\r\nimport org.joget.commons.util.LogUtil;\r\n\r\n \r\npublic FormRowSet load(String[] values) {\r\n\r\n    FormRowSet rows = new FormRowSet();\r\n    \r\n    FormRow option = new FormRow();\r\n    option.setProperty(FormUtil.PROPERTY_VALUE, \"\");\r\n    option.setProperty(FormUtil.PROPERTY_LABEL, \"\");\r\n    rows.add(option);\r\n    \r\n    String banco = null;\r\n    if (values != null && values.length > 0) {\r\n        banco = \"%\" + values[0] + \"%\";\r\n    \r\n        Connection con = null;\r\n        PreparedStatement stmt = null;\r\n        ResultSet rs = null;\r\n        String origem_value = \"\";\r\n        String origem_label = \"\";\r\n        \r\n        AppDefinition appDef = AppUtil.getCurrentAppDefinition();\r\n        \r\n        try{\r\n                DataSource ds = (DataSource)AppUtil.getApplicationContext().getBean(\"setupDataSource\");\r\n                con = ds.getConnection();\r\n                \r\n                \r\n                if(!con.isClosed()){\r\n                    \r\n                    String query=\"SELECT c_value, c_label FROM app_fd_listas_de_valores WHERE c_nome_campo = ? AND c_banco LIKE ? AND c_servico LIKE '%PROCU%';\";\r\n                    stmt = con.prepareStatement(query);\r\n                    stmt.setObject(1, \"tipo_processo\");\r\n                    stmt.setObject(2, banco);\r\n                    rs = stmt.executeQuery();\r\n                    \r\n                    while(rs.next()){\r\n                        origem_value = rs.getString(1);\r\n                        origem_label = rs.getString(2);\r\n                        \r\n                        FormRow option = new FormRow();\r\n                        option.setProperty(FormUtil.PROPERTY_VALUE, origem_value);\r\n                        option.setProperty(FormUtil.PROPERTY_LABEL, origem_label);\r\n                        \r\n                        rows.add(option);\r\n                        \r\n                    }\r\n                }\r\n                \r\n        }catch(Exception e){\r\n            LogUtil.error(\"Importa processo - origem de processo\", e, \"Error getting info from DB\");\r\n        }finally{\r\n            try{\r\n                if(rs != null){\r\n                rs.close();\r\n                }\r\n                if(stmt != null){\r\n                    stmt.close();\r\n                }\r\n                if(con != null && !con.isClosed()) {\r\n                    con.close();\r\n                }\r\n            }catch(Exception e){\r\n                LogUtil.error(\"Importa processo - origem de processo\", e, \"Error closing DB connection\");\r\n            }\r\n            \r\n        }\r\n        \r\n    }\r\n\r\n    return rows;\r\n}\r\n \r\n//call load method with injected variable\r\nreturn load(values);",
                                "useAjax": "true"
                            }
                        },
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                            "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                            "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "787c67d4-d157-ca8e-655e-43717638627d": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                            "e94738b9-1966-5300-3072-703d03acb3df": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {
                                "permissionHidden": "",
                                "readonly": "true"
                            },
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {
                                "permissionHidden": "",
                                "readonly": "true"
                            }
                        },
                        "readonly": "",
                        "readonlyLabel": "",
                        "size": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.HiddenField",
                    "properties": {
                        "id": "bf_tipoProcesso",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                            "787c67d4-d157-ca8e-655e-43717638627d": {},
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {},
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                        },
                        "useDefaultWhenEmpty": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.SelectBox",
                    "properties": {
                        "controlField": "",
                        "id": "fundo_mtg",
                        "label": "Fundo",
                        "multiple": "",
                        "options": [],
                        "optionsBinder": {
                            "className": "org.joget.apps.form.lib.FormOptionsBinder",
                            "properties": {
                                "addEmptyOption": "true",
                                "cacheInterval": "",
                                "emptyLabel": "",
                                "extraCondition": "c_nome_campo = 'fundo_mtg' AND e.customProperties.servico LIKE '%PROCU%'",
                                "formDefId": "adicionarOpcaoLV",
                                "groupingColumn": "",
                                "idColumn": "value",
                                "labelColumn": "label",
                                "useAjax": ""
                            }
                        },
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "787c67d4-d157-ca8e-655e-43717638627d": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {
                                "permissionHidden": "true",
                                "readonly": ""
                            }
                        },
                        "readonly": "",
                        "readonlyLabel": "",
                        "size": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.SelectBox",
                    "properties": {
                        "controlField": "bf_tipoProcesso",
                        "id": "sociedade_representada",
                        "label": "Sociedade Representada",
                        "multiple": "",
                        "options": [],
                        "optionsBinder": {
                            "className": "org.joget.apps.form.lib.BeanShellFormBinder",
                            "properties": {
                                "cacheInterval": "",
                                "script": "import org.joget.apps.app.service.AppUtil;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.apps.form.model.FormRow;\r\nimport org.joget.apps.form.model.FormRowSet;\r\nimport org.joget.apps.form.model.FormStoreBinder;\r\nimport java.sql.Connection;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport javax.sql.DataSource;\r\nimport org.joget.apps.form.service.FormUtil;\r\nimport org.joget.apps.app.model.AppDefinition;\r\nimport org.joget.commons.util.LogUtil;\r\n\r\n \r\npublic FormRowSet load(String[] values) {\r\n\r\n    \r\n    FormRowSet rows = new FormRowSet();\r\n    \r\n    FormRow option = new FormRow();\r\n    option.setProperty(FormUtil.PROPERTY_VALUE, \"\");\r\n    option.setProperty(FormUtil.PROPERTY_LABEL, \"\");\r\n    rows.add(option);\r\n    \r\n    String banco = null;\r\n    String[] bf_tipoProcesso = null;\r\n    String tipoProcesso = null;\r\n    if (values != null && values.length > 0) {\r\n        bf_tipoProcesso = values[0].split(\"_\");\r\n\r\n        if(bf_tipoProcesso.length > 0){\r\n            banco = \"%\" + bf_tipoProcesso[0] + \"%\";\r\n        }else{\r\n            banco = \"%%\";\r\n        }\r\n\r\n        \r\n        if(banco.equals(\"%MTG%\") && bf_tipoProcesso.length > 1){\r\n            tipoProcesso = bf_tipoProcesso[1]; \r\n            if(/*tipoProcesso.equals(\"MUT\") ||*/ tipoProcesso.equals(\"VIM\")){\r\n                tipoProcesso = \"%\" + tipoProcesso + \"%\";\r\n            }else{\r\n                tipoProcesso = \"%%\";\r\n            }\r\n        }else{\r\n             tipoProcesso = \"%%\";\r\n        }\r\n        \r\n        \r\n        \r\n        \r\n        Connection con = null;\r\n        PreparedStatement stmt = null;\r\n        ResultSet rs = null;\r\n        String origem_value = \"\";\r\n        String origem_label = \"\";\r\n        \r\n        AppDefinition appDef = AppUtil.getCurrentAppDefinition();\r\n        \r\n        try{\r\n                DataSource ds = (DataSource)AppUtil.getApplicationContext().getBean(\"setupDataSource\");\r\n                con = ds.getConnection();\r\n                \r\n                LogUtil.info(\"Banco\", \"AAA\" +  banco);\r\n                LogUtil.info(\"TP\", \"AAA\" +  tipoProcesso);\r\n                \r\n                if(!con.isClosed()){\r\n                    String idDetalhe_processo = \"#form.processos.detalhe_processo#\";\r\n                    //Verificar o utilizador atribuido e atualizar caso esteja errado\r\n                    String query=\"SELECT c_value, c_label FROM app_fd_listas_de_valores WHERE c_nome_campo = ? AND c_banco LIKE ? AND c_servico LIKE '%PROCU%' AND c_grouping LIKE ?;\";\r\n                    stmt = con.prepareStatement(query);\r\n                    stmt.setObject(1, \"sociedade_representada\");\r\n                    stmt.setObject(2, banco);\r\n                    stmt.setObject(3, tipoProcesso);\r\n                    rs = stmt.executeQuery();\r\n                    \r\n                    while(rs.next()){\r\n                        origem_value = rs.getString(1);\r\n                        origem_label = rs.getString(2);\r\n                        \r\n                        FormRow option = new FormRow();\r\n                        option.setProperty(FormUtil.PROPERTY_VALUE, origem_value);\r\n                        option.setProperty(FormUtil.PROPERTY_LABEL, origem_label);\r\n                        \r\n                        rows.add(option);\r\n                        \r\n                    }\r\n                }\r\n                \r\n        }catch(Exception e){\r\n            LogUtil.error(\"Importa processo - origem de processo\", e, \"Error getting info from DB\");\r\n        }finally{\r\n            try{\r\n                if(rs != null){\r\n                rs.close();\r\n                }\r\n                if(stmt != null){\r\n                    stmt.close();\r\n                }\r\n                if(con != null && !con.isClosed()) {\r\n                    con.close();\r\n                }\r\n            }catch(Exception e){\r\n                LogUtil.error(\"Importa processo - origem de processo\", e, \"Error closing DB connection\");\r\n            }\r\n            \r\n        }\r\n        \r\n    }\r\n\r\n    return rows;\r\n}\r\n \r\n//call load method with injected variable\r\nreturn load(values);",
                                "useAjax": "true"
                            }
                        },
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                            "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                            "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                            "787c67d4-d157-ca8e-655e-43717638627d": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                            "e94738b9-1966-5300-3072-703d03acb3df": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {},
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                        },
                        "readonly": "",
                        "readonlyLabel": "",
                        "size": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.SelectBox",
                    "properties": {
                        "controlField": "",
                        "id": "data_hora_agendamento",
                        "label": "",
                        "multiple": "",
                        "options": [],
                        "optionsBinder": {
                            "className": "org.joget.apps.form.lib.BeanShellFormBinder",
                            "properties": {
                                "cacheInterval": "",
                                "script": "import org.joget.apps.app.service.AppUtil;\nimport org.joget.apps.form.model.Element;\nimport org.joget.apps.form.model.FormData;\nimport org.joget.apps.form.model.FormRow;\nimport org.joget.apps.form.model.FormRowSet;\nimport org.joget.apps.form.model.FormStoreBinder;\nimport java.sql.Connection;\nimport java.sql.PreparedStatement;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport javax.sql.DataSource;\nimport org.joget.apps.form.service.FormUtil;\nimport org.joget.apps.app.model.AppDefinition;\nimport org.joget.commons.util.LogUtil;\n\n\npublic FormRowSet getDataAgendamento() {\n    Connection con = null;\n    PreparedStatement stmt = null;\n    ResultSet rs = null;\n    String dataOutorga = \"\";\n    String horaOutorga = \"\";\n    String data_hora = \"\";\n    \n    AppDefinition appDef = AppUtil.getCurrentAppDefinition();\n    \n    \n    try{\n            DataSource ds = (DataSource)AppUtil.getApplicationContext().getBean(\"setupDataSource\");\n            con = ds.getConnection();\n            \n            if(!con.isClosed()){\n                \n                String idProcesso = \"#form.processos_procu.id#\";\n                \n                String queryGetLastAto = \"SELECT c_dataOutorga, c_horaOutorga FROM app_fd_atos_procu WHERE c_id_processo = ? ORDER BY dateCreated DESC LIMIT 1\";\n                stmt = con.prepareStatement(queryGetLastAto);\n                stmt.setObject(1, idProcesso);\n                rs = stmt.executeQuery();\n                if(rs.next()){\n                    dataOutorga = rs.getObject(\"c_dataOutorga\");\n                    horaOutorga = rs.getObject(\"c_horaOutorga\");\n                    \n                }\n\n                  data_hora = dataOutorga + \" \" + horaOutorga;  \n            }\n            \n    }catch(Exception e){\n        LogUtil.error(appDef.toString(), e, \"Error getting info from DB\");\n    }finally{\n        try{\n            if(rs != null){\n            rs.close();\n            }\n            if(stmt != null){\n                stmt.close();\n            }\n            if(con != null && !con.isClosed()) {\n                con.close();\n            }\n        }catch(Exception e){\n            LogUtil.error(appDef.toString(), e, \"Error closing DB connection\");\n        }\n        \n    }\n    FormRowSet f = new FormRowSet();\n    FormRow r1 = new FormRow();\n    r1.put(FormUtil.PROPERTY_VALUE, data_hora);\n    r1.put(FormUtil.PROPERTY_LABEL, \"\");\n    f.add(r1);\n    return f;\n}\n \nreturn getDataAgendamento();\n        ",
                                "useAjax": ""
                            }
                        },
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                            "787c67d4-d157-ca8e-655e-43717638627d": {
                                "permissionHidden": "",
                                "readonly": ""
                            },
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {},
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                        },
                        "readonly": "",
                        "readonlyLabel": "",
                        "size": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.SelectBox",
                    "properties": {
                        "controlField": "",
                        "id": "localizacao_imovel",
                        "label": "Localização do Imóvel",
                        "multiple": "",
                        "options": [],
                        "optionsBinder": {
                            "className": "org.joget.apps.form.lib.FormOptionsBinder",
                            "properties": {
                                "addEmptyOption": "true",
                                "cacheInterval": "",
                                "emptyLabel": "",
                                "extraCondition": "c_nome_campo = 'local_imovel' AND e.customProperties.servico LIKE '%PROCU%'",
                                "formDefId": "adicionarOpcaoLV",
                                "groupingColumn": "",
                                "idColumn": "value",
                                "labelColumn": "label",
                                "useAjax": ""
                            }
                        },
                        "permissionHidden": "true",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "504595d7-fa4b-d219-d8a6-65d1a4da0728": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "787c67d4-d157-ca8e-655e-43717638627d": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "e94738b9-1966-5300-3072-703d03acb3df": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "ee177599-9c69-d878-10f8-9aebde208e06": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {
                                "permissionHidden": "true",
                                "readonly": ""
                            }
                        },
                        "readonly": "",
                        "readonlyLabel": "",
                        "size": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.SelectBox",
                    "properties": {
                        "controlField": "",
                        "id": "estado",
                        "label": "Estado",
                        "multiple": "",
                        "options": [],
                        "optionsBinder": {
                            "className": "org.joget.apps.form.lib.FormOptionsBinder",
                            "properties": {
                                "addEmptyOption": "true",
                                "cacheInterval": "",
                                "emptyLabel": "",
                                "extraCondition": "c_nome_campo = 'estado_processo' AND e.customProperties.servico LIKE '%PROCU%'",
                                "formDefId": "adicionarOpcaoLV",
                                "groupingColumn": "",
                                "idColumn": "value",
                                "labelColumn": "label",
                                "useAjax": ""
                            }
                        },
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                            "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                            "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                            "787c67d4-d157-ca8e-655e-43717638627d": {},
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                            "e94738b9-1966-5300-3072-703d03acb3df": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {},
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                        },
                        "readonly": "",
                        "readonlyLabel": "",
                        "size": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.TextField",
                    "properties": {
                        "encryption": "",
                        "id": "codigo_certidao_predial",
                        "label": "Código de Certidão Perdial",
                        "maxlength": "",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "787c67d4-d157-ca8e-655e-43717638627d": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {
                                "permissionHidden": "true",
                                "readonly": ""
                            }
                        },
                        "placeholder": "",
                        "readonly": "",
                        "readonlyLabel": "",
                        "size": "",
                        "storeNumeric": "",
                        "style": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.DatePicker",
                    "properties": {
                        "allowManual": "",
                        "currentDateAs": "",
                        "dataFormat": "yyyy-MM-dd",
                        "datePickerType": "",
                        "endDateFieldId": "",
                        "format": "",
                        "id": "validade_certidao",
                        "label": "Validade da Certidão",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "787c67d4-d157-ca8e-655e-43717638627d": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {
                                "permissionHidden": "true",
                                "readonly": ""
                            },
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {
                                "permissionHidden": "true",
                                "readonly": ""
                            }
                        },
                        "placeholder": "",
                        "readonly": "",
                        "readonlyLabel": "",
                        "startDateFieldId": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": "",
                        "yearRange": "c-10:c+10"
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.HiddenField",
                    "properties": {
                        "id": "flag_notificacao_certidao",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                            "787c67d4-d157-ca8e-655e-43717638627d": {},
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {},
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                        },
                        "useDefaultWhenEmpty": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.CheckBox",
                    "properties": {
                        "controlField": "",
                        "id": "alerta_gestor",
                        "label": "Alerta para Gestor",
                        "options": [{
                            "grouping": "",
                            "label": "Sim",
                            "value": "SIM"
                        }],
                        "optionsBinder": {
                            "className": "",
                            "properties": {}
                        },
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                            "787c67d4-d157-ca8e-655e-43717638627d": {},
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {},
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                        },
                        "readonly": "",
                        "readonlyLabel": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.CustomHTML",
                    "properties": {
                        "autoPopulate": "",
                        "id": "field20",
                        "label": "",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                            "787c67d4-d157-ca8e-655e-43717638627d": {},
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {},
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                        },
                        "value": "<script type=\"text/javascript\">\r\n\r\n    $(document).ready(function(){\r\n\r\n        \r\n        //Campos de alerta para o gestor\r\n       $(\"input[id*=alerta_gestor]\").change(function(){\r\n           \r\n           //Se o campo tiver checked preenche campos de gestor e data do alerta\r\n           if($(\"input[id*=alerta_gestor]\").is(\":checked\")){\r\n               \r\n               $(\"input[id*=user_alerta]\").val(\"#currentUser.username#\");\r\n               //Data atual mais 2 dias\r\n               $(\"input[id*=data_alerta]\").val(\"#date.DAY+2.yyyy-MM-dd#\");\r\n               \r\n           }\r\n       });\r\n       \r\n       $(\"select[id*=banco_fundo]\").change(function(){\r\n            var bancoFundo = $(\"select[id*=banco_fundo]\").val();\r\n            var tipoProcesso = $(\"select[id*=tipo_processo]\").val();\r\n            var bf_tipoProcesso = bancoFundo + \"_\" + tipoProcesso;\r\n             $(\"input[id*=bf_tipoProcesso]\").val(bf_tipoProcesso);\r\n             $(\"input[id*=bf_tipoProcesso]\").change();\r\n       });\r\n       $(\"select[id*=tipo_processo]\").change(function(){\r\n           var bancoFundo = $(\"select[id*=banco_fundo]\").val();\r\n            var tipoProcesso = $(\"select[id*=tipo_processo]\").val();\r\n            var bf_tipoProcesso = bancoFundo + \"_\" + tipoProcesso;\r\n            $(\"input[id*=bf_tipoProcesso]\").val(bf_tipoProcesso);\r\n            $(\"input[id*=bf_tipoProcesso]\").change();\r\n       });\r\n       \r\n       //Remover botão de concluir apenas para Procuradoria\r\n       $(\"input#assignmentComplete\").remove();\r\n        \r\n    \r\n    \r\n    });\r\n<\/script> "
                    }
                },
                {
                    "className": "org.joget.apps.form.lib.CustomHTML",
                    "properties": {
                        "autoPopulate": "",
                        "id": "field24",
                        "label": "",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                            "787c67d4-d157-ca8e-655e-43717638627d": {},
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                            "ee177599-9c69-d878-10f8-9aebde208e06": {},
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                        },
                        "value": "<script>\n    $(document).ready(function(){\n        atualizarVisibilidadeBCP();\n        atualizarVisibilidadesMTG();\n        var data_hora = $(\"select[id*=data_hora_agendamento]\").val();\n        $(\"select[id*=data_hora_agendamento]\").hide();\n        $(\"select[id*=banco_fundo]\").change(function(){\n            atualizarVisibilidadeBCP();\n            atualizarVisibilidadesMTG();\n        });\n        \n        $(\"select[id*=tipo_processo]\").change(function(){\n            atualizarVisibilidadeBCP();\n            atualizarVisibilidadesMTG();\n        });\n  \n    });\n    \n    \n    \n    \n    function atualizarVisibilidadeBCP(){\n        var tipoProcesso = $(\"select[name*=tipo_processo] option:selected\").val();\n        var banco_fundo = $(\"select[name*=banco_fundo] option:selected\").val();\n        if(banco_fundo==='BCP'){\n            if (tipoProcesso === 'DIST' || tipoProcesso === 'MUT' || tipoProcesso === 'LEAS'){\n                $(\"select[id*=sociedade_representada]\").parent().hide();\n                $(\"input[id*=codigo_certidao_predial]\").parent().hide();\n                $(\"input[id*=validade_certidao]\").parent().hide();\n            }else{\n                $(\"select[id*=sociedade_representada]\").parent().show();\n                $(\"input[id*=codigo_certidao_predial]\").parent().show();\n                $(\"input[id*=validade_certidao]\").parent().show();\n            }\n            if(tipoProcesso === 'DIST' || tipoProcesso === 'DAC' || tipoProcesso === 'ISV' || tipoProcesso === 'CVJ'){\n                $(\"input[id*=n_comservice]\").parent().show();\n            }else{\n                $(\"input[id*=n_comservice]\").parent().hide();\n            }\n\n        }\n    }\n    \n    function atualizarVisibilidadesMTG(){\n        var tipoProcesso = $(\"select[name*=tipo_processo] option:selected\").val();\n        var banco_fundo = $(\"select[name*=banco_fundo] option:selected\").val();\n        if(banco_fundo === 'MTG'){\n            if(tipoProcesso === 'VIM'){\n                $(\"select[id*=fundo_mtg]\").parent().show();\n                $(\"select[id*=sociedade_representada]\").parent().show();\n            }else{\n                $(\"select[id*=fundo_mtg]\").parent().hide();\n                $(\"select[id*=sociedade_representada]\").parent().hide();\n            }\n        }\n    }\n\n<\/script>"
                    }
                }
            ],
            "properties": {"width": "100%"}
        }],
        "properties": {
            "comment": "",
            "id": "section1_1",
            "join": "",
            "label": "Informação Geral",
            "loadBinder": {
                "className": "",
                "properties": {}
            },
            "permission": {
                "className": "",
                "properties": {}
            },
            "permissionReadonly": "",
            "permission_rules": {
                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                "787c67d4-d157-ca8e-655e-43717638627d": {},
                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                "e94738b9-1966-5300-3072-703d03acb3df": {},
                "ee177599-9c69-d878-10f8-9aebde208e06": {},
                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
            },
            "readonly": "",
            "readonlyLabel": "",
            "regex": "",
            "reverse": "",
            "storeBinder": {
                "className": "",
                "properties": {}
            },
            "visibilityControl": "",
            "visibilityValue": ""
        }
    }],
    "properties": {
        "description": "",
        "id": "detalheProcessoProcuradoria",
        "loadBinder": {
            "className": "org.joget.apps.form.lib.WorkflowFormBinder",
            "properties": {}
        },
        "name": "Procuradoria - Detalhe Processo",
        "noPermissionMessage": "",
        "permission": {
            "className": "",
            "properties": {}
        },
        "permission_rules": [
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"NVB\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "787c67d4-d157-ca8e-655e-43717638627d",
                "permission_name": "NVB"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"MTG\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "87e7b01c-e92b-e732-c50f-c2c7020e5482",
                "permission_name": "MTG"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"BIC\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "2dd4cc96-cc40-f285-e376-ebda47490646",
                "permission_name": "BIC"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"BNI\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "0c699003-580e-7faf-a39c-f2e5303bd5b5",
                "permission_name": "BNI"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"BCP\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "44639061-b6ba-a2ef-a47c-c5bab888544c",
                "permission_name": "BCP"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"HPG\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "f8c01627-bf37-05aa-5732-90fe1b2327b3",
                "permission_name": "Hipoges (HPG)"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"NOR\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "710a05c8-c837-e0d0-670a-720473cb5a7c",
                "permission_name": "Norfin (NOR)"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"DHM\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "ee177599-9c69-d878-10f8-9aebde208e06",
                "permission_name": "DHM"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"WHS\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "1804038d-e85d-3ea4-4ef3-4c4143e5145b",
                "permission_name": "Whitestar (WHS)"
            }
        ],
        "postProcessor": {
            "className": "",
            "properties": {}
        },
        "postProcessorRunOn": "create",
        "storeBinder": {
            "className": "org.joget.apps.form.lib.BeanShellFormBinder",
            "properties": {
                "autoHandleFiles": "",
                "autoHandleWorkflowVariable": "true",
                "cacheInterval": "",
                "script": "import org.joget.apps.app.service.AppUtil;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.apps.form.model.FormRow;\r\nimport org.joget.apps.form.model.FormRowSet;\r\nimport org.joget.apps.form.model.FormStoreBinder;\r\nimport org.joget.plugin.base.PluginManager;\r\nimport org.joget.commons.util.LogUtil;\r\n\r\nimport java.sql.Connection;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport javax.sql.DataSource;\r\nimport org.joget.apps.form.service.FormUtil;\r\nimport org.joget.apps.app.model.AppDefinition;\r\nimport org.joget.commons.util.UuidGenerator;\r\n\r\nimport java.time.LocalDateTime;\r\nimport java.time.LocalDate;\r\nimport java.time.format.DateTimeFormatter;\r\nimport java.time.DayOfWeek;\r\nimport java.time.temporal.ChronoUnit;\r\n\r\n\r\n\r\npublic String calculateSLAD(String dataInicio, Collection feriados, String sla, String urgencia){\r\n    \r\n    DateTimeFormatter formatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm\");\r\n    DateTimeFormatter dateFormatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd\");\r\n    LocalDateTime dateInit = LocalDateTime.parse(dataInicio, formatter);  \r\n    LocalDateTime endDateTime = null;\r\n    String endDate = \"\";\r\n    Collection holidays = feriados;\r\n    \r\n    \r\n    \r\n    var hour = dateInit.getHour();\r\n    int slaNumber = Integer.parseInt(sla);\r\n\r\n    \r\n    if(urgencia.equals(\"SIM\")){\r\n        //Calcular SLA urgente\r\n        endDateTime = dateInit.plusHours(slaNumber);\r\n        //Passar dias não uteis\r\n        while(isWeekend(endDateTime) || holidays.contains(endDateTime.format(dateFormatter))){\r\n           endDateTime = endDateTime.plusDays(1);\r\n        }\r\n        \r\n        endDate = endDateTime.format(formatter);\r\n\r\n    }else{\r\n\r\n        //Calcular SLA não urgente\r\n\r\n            if(hour < 12){\r\n                endDateTime = dateInit.withHour(23).withMinute(59);   /**   HORAS UTEIS???   **/\r\n                \r\n                //Incrementar dias consoante o SLA\r\n                while(slaNumber > 1){\r\n                    endDateTime = endDateTime.plusDays(1);\r\n                    //Passar dias não uteis\r\n                    while(isWeekend(endDateTime) || holidays.contains(endDateTime.format(dateFormatter))){\r\n                       endDateTime = endDateTime.plusDays(1);\r\n                    }   \r\n                    slaNumber -= 1;\r\n                }\r\n            }else{\r\n                endDateTime = dateInit.plusDays(1).withHour(12).withMinute(0);\r\n                while(isWeekend(endDateTime) || holidays.contains(endDateTime.format(dateFormatter))){\r\n                       endDateTime = endDateTime.plusDays(1);\r\n                }\r\n                \r\n                //Incrementar dias consoante o SLA\r\n                while(slaNumber > 1){\r\n                    endDateTime = endDateTime.plusDays(1);\r\n                    //Passar dias não uteis\r\n                    while(isWeekend(endDateTime) || holidays.contains(endDateTime.format(dateFormatter))){\r\n                       endDateTime = endDateTime.plusDays(1);\r\n                    }\r\n                    slaNumber -= 1;\r\n                }\r\n            }\r\n            \r\n        endDate = endDateTime.format(formatter);\r\n    }\r\n    \r\n    return endDate;\r\n}\r\n\r\n//Calcular duração do SLA\r\npublic String calculateSLADuration(String dataInit, Collection holidays){\r\n    DateTimeFormatter formatter = DateTimeFormatter.ofPattern(\"dd/MM/yyyy HH:mm\");\r\n    DateTimeFormatter dateFormatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd\");\r\n    String result=\"\";\r\n    //if Data Init date format is not \"dd/MM/yyyy HH:mm\"\r\n    if(dataInit.charAt(2) != '/'){\r\n        //if Data Init date format is of the format \"yyyy-MM-dd HH:mm\"\r\n        if(dataInit.charAt(4) == '-' && dataInit.charAt(10) == ' ' && dataInit.charAt(13) == ':'){\r\n            dataInit =  dataInit.substring(8,10) + \"/\" + dataInit.substring(5,7) + \"/\" + dataInit.substring(0,4) + \" \" + dataInit.substring(11,16);\r\n        }\r\n    }\r\n\r\n    LocalDateTime dateInit = LocalDateTime.parse(dataInit, formatter);\r\n    LocalDateTime dateNow = LocalDateTime.parse(\"#date.dd/MM/yyyy HH:mm#\",formatter);\r\n    \r\n    LocalDate dateInitDays = dateInit.toLocalDate();\r\n    LocalDate dateNowDays = dateNow.toLocalDate();\r\n    long days = ChronoUnit.DAYS.between(dateInitDays, dateNowDays);\r\n    \r\n    int initHours = dateInit.getHour();\r\n    int nowHours = dateNow.getHour();\r\n    if(initHours > 12 && nowHours < 12){\r\n        days= days - 1;    \r\n    }else if(days>0 && initHours < 12 && nowHours >= 12){\r\n        days = days + 1;\r\n    }\r\n    \r\n    long workDays = days;\r\n    \r\n    while(days>0){\r\n        \r\n        if(holidays.contains(dateInit.format(dateFormatter))){\r\n            workDays-=1;\r\n            \r\n        }else{\r\n            String day = dateInit.getDayOfWeek().toString();\r\n        \r\n            switch(day) {\r\n                case \"SATURDAY\":{\r\n                    workDays-=1;\r\n                    break;\r\n                }\r\n                case \"SUNDAY\":{\r\n                    workDays-=1;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        \r\n\r\n        dateInit = dateInit.plusDays(1);\r\n  \r\n        days-=1;\r\n    }\r\n    \r\n    result = \"D\";\r\n    if(workDays>0){\r\n        result =result + \"+\" + workDays;\r\n    }\r\n    return result;\r\n}\r\n\r\n//Obter lista de feriados\r\npublic Collection getHolidays(Connection con){\r\n    Collection holidays = new ArrayList(); \r\n    try{\r\n        String queryGetHolidays = \"SELECT * FROM app_fd_lista_feriados;\";\r\n        PreparedStatement stmt = con.prepareStatement(queryGetHolidays);\r\n        ResultSet rs = stmt.executeQuery();\r\n        while(rs.next()){\r\n            holidays.add(rs.getObject(\"c_data\"));\r\n        }\r\n    } catch(Exception e) {\r\n        LogUtil.error(\"Load Binder - Resumo Procuradoria \", e, \"Error getting holidays\");\r\n    } \r\n    \r\n    return holidays;\r\n}\r\n\r\n//Verificar de o dia é fim de semana\r\npublic boolean isWeekend(LocalDateTime dt) {\r\n    String dayOfWeek = dt.getDayOfWeek().toString();\r\n    switch(dayOfWeek) {\r\n        case \"SATURDAY\":{\r\n            return true;\r\n        }\r\n        case \"SUNDAY\":{\r\n            return true;\r\n        }\r\n        default:{\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\n\r\npublic FormRowSet store(Element element, FormRowSet rows, FormData formData) {\r\n       //check the rows is not empty before store it\r\n       FormRow row = null;\r\n    if (rows != null && !rows.isEmpty()) {\r\n        //Get the submitted data\r\n        row = rows.get(0);\r\n        \r\n\r\n        String ProcessID = \"#process.processId#\";\r\n        String mainProcessId = rows.get(0).get(\"id_processo\");\r\n        String EstadoContratacao = rows.get(0).get(\"estado\");\r\n        String dataUltimaEntrada = rows.get(0).get(\"data_entrada\");\r\n        String dataComunicacaoCliente = rows.get(0).get(\"data_comunicacao_cliente\");\r\n        \r\n        var SLAIsOpen = false;\r\n        \r\n        Connection con = null;\r\n        PreparedStatement stmt = null;\r\n        ResultSet rs = null;\r\n    \r\n        try{\r\n            \r\n            DataSource ds = (DataSource)AppUtil.getApplicationContext().getBean(\"setupDataSource\");\r\n            con = ds.getConnection();\r\n            \r\n            if(!con.isClosed()){    \r\n                \r\n                if(ProcessID.startsWith(\"#process.processId\")){\r\n                                                 \r\n                    String queryGetProcessId = \"SELECT Id FROM shkprocesses WHERE ActivityRequesterProcessId = ? order by created desc ;\";\r\n                    stmt = con.prepareStatement(queryGetProcessId);\r\n                    stmt.setObject(1, mainProcessId);\r\n                    rs = stmt.executeQuery();\r\n                    if(rs.next()){\r\n                        ProcessID = rs.getObject(\"Id\");\r\n                    }\r\n                \r\n                }\r\n                \r\n                \r\n                //Verificar se existe algum SLA do processo em aberto\r\n                String queryGetOpenSLA = \"SELECT id FROM app_fd_sla_atividade WHERE c_id_processo=? AND c_estado_atividade = 'Em curso';\";\r\n                stmt = con.prepareStatement(queryGetOpenSLA);\r\n                stmt.setObject(1, ProcessID);\r\n                rs = stmt.executeQuery();\r\n                \r\n                if(rs.next()){\r\n                    SLAIsOpen = true;\r\n                }\r\n                    \r\n                    \r\n                String dataUltimaEntradaBd = \"#form.detalhe_proce_procu.data_entrada[{form.processos_procu.detalhe_processo}]#\";\r\n                if(!dataUltimaEntrada.equals(dataUltimaEntradaBd)){\r\n                    \r\n                    //Se não existir nenhum SLA 'Em curso'\r\n                    if(!SLAIsOpen){\r\n                        \r\n                      /**Abrir novo SLA**/\r\n                      //Se \"Data de Ultima Entrada\" tiver vazia o SLA é iniciado  \r\n                        if(!dataUltimaEntrada.isEmpty()){\r\n                            \r\n                            //Obter feriados para o cálculo do SLA\r\n                            Collection holidays = getHolidays(con);\r\n                            \r\n                            //Obter detalhes da tarefa\r\n                            String queryGetAssignment = \"SELECT name FROM shkprocesses WHERE id=?;\";\r\n                            String queryGetUserAssign = \"SELECT resourceid FROM shkassignmentstable WHERE activityprocessid =?\";\r\n                            String nomeAtividade = \"\";\r\n                            String utilizador = \"\";\r\n                            stmt = con.prepareStatement(queryGetAssignment);\r\n                            stmt.setObject(1, ProcessID);\r\n                            rs = stmt.executeQuery();\r\n                            \r\n                            if(rs.next()){\r\n                                nomeAtividade= rs.getObject(\"name\").toString();\r\n                            }\r\n                            \r\n                            stmt = con.prepareStatement(queryGetUserAssign);\r\n                            stmt.setObject(1, ProcessID);\r\n                            rs = stmt.executeQuery();\r\n                            \r\n                            if(rs.next()){\r\n                                utilizador= rs.getObject(\"resourceid\").toString();\r\n                            }\r\n                            \r\n                            \r\n                            //Iniciar novo SLA em curso\r\n                            String queryCreateSLA = \"INSERT INTO app_fd_sla_atividade (id, dateCreated, dateModified, createdBy,createdByName ,modifiedBy, modifiedByName, c_data_inicio, c_data_fim, c_nome_atividade, c_id_processo, c_utilizador_atribuido, c_estado_atividade, c_duracao) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?);\";\r\n                            stmt = con.prepareStatement(queryCreateSLA);\r\n                            var idSLA = UuidGenerator.getInstance().getUuid();\r\n                            var dateNow =\"#date.yyyy-MM-dd HH:mm#\";\r\n                            var currentUsername = \"#currentUser.username#\";\r\n                            var currentNameUser = \"#currentUser.firstName#\" + \"#currentUser.lastName#\";\r\n                            String dataInicio = dataUltimaEntrada;\r\n\r\n                            dataFim = calculateSLAD(dataInicio, holidays,\"1\",\"NAO\");\r\n                            String estadoAtividade = \"Em curso\";\r\n                            String duracao = calculateSLADuration(dataInicio, holidays);\r\n                            \r\n                            stmt.setObject(1, idSLA);\r\n                            stmt.setObject(2, dateNow);\r\n                            stmt.setObject(3, dateNow);\r\n                            stmt.setObject(4, currentUsername);\r\n                            stmt.setObject(5, currentNameUser);\r\n                            stmt.setObject(6, currentUsername);\r\n                            stmt.setObject(7, currentNameUser);\r\n                            stmt.setObject(8, dataInicio);\r\n                            stmt.setObject(9, dataFim);   \r\n                            stmt.setObject(10, nomeAtividade);\r\n                            stmt.setObject(11, ProcessID);\r\n                            stmt.setObject(12, utilizador);\r\n                            stmt.setObject(13, estadoAtividade);\r\n                            stmt.setObject(14, duracao);\r\n                            stmt.executeQuery();\r\n                            \r\n                           // LogUtil.info(\"AAAAA\", \"Insert new SLA\");\r\n                           \r\n                           //Caso exista um ato com Agendamento confirmado, limpar data de comunicação ao cliente\r\n                           String queryGetLastAto = \"SELECT id, c_status, c_data_comunicacao_cliente FROM app_fd_atos WHERE c_id_processo = ? AND c_status = 'ACOM';\";\r\n                           stmt = con.prepareStatement(queryGetLastAto);\r\n                           stmt.setObject(1, mainProcessId);\r\n                           rs = stmt.executeQuery();\r\n                           String dataComunicacao = \"\";\r\n                           String idAto = \"\";\r\n                           if(rs.next()){\r\n                               dataComunicacao = rs.getObject(\"c_data_comunicacao_cliente\");\r\n                               idAto = rs.getObject(\"id\");\r\n                               if(!dataComunicacao.isEmpty()){\r\n                                   String queryResetDataComunicacao = \"UPDATE app_fd_atos SET c_data_comunicacao_cliente = '' WHERE id = ?\";\r\n                                   stmt = con.prepareStatement(queryResetDataComunicacao);\r\n                                   stmt.setObject(1, idAto);\r\n                                   stmt.executeQuery();\r\n                               }\r\n                               \r\n                           }\r\n                           \r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n        }catch(Exception e){\r\n            LogUtil.error(\"Olimpo- Store Binder Detalhe Processo Procuradoria\", e, \"Error getting info from DB\");\r\n        \r\n        }finally{\r\n            try{\r\n                if(rs != null){\r\n                rs.close();\r\n                }\r\n                if(stmt != null){\r\n                    stmt.close();\r\n                }\r\n                if(con != null && !con.isClosed()) {\r\n                    con.close();\r\n                }\r\n            }catch(Exception e){\r\n                LogUtil.error(\"Olimpo- Store Binder Detalhe Processo\", e, \"Error closing DB connection\");\r\n            }\r\n            \r\n        }\r\n        \r\n\r\n    \r\n     //Reuse Workflow Form Binder to store data\r\n        PluginManager pluginManager = (PluginManager) AppUtil.getApplicationContext().getBean(\"pluginManager\");\r\n        FormStoreBinder binder = (FormStoreBinder) pluginManager.getPlugin(\"org.joget.apps.form.lib.WorkflowFormBinder\");\r\n        binder.store(element, rows, formData);\r\n    } \r\n    \r\n    return rows;\r\n}\r\n\r\nreturn store(element, rows, formData);",
                "useAjax": ""
            }
        },
        "tableName": "detalhe_proce_procu"
    }
}