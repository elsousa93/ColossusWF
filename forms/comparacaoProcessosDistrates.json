{
    "className": "org.joget.apps.form.model.Form",
    "elements": [{
        "className": "org.joget.apps.form.model.Section",
        "elements": [{
            "className": "org.joget.apps.form.model.Column",
            "elements": [{
                "className": "org.joget.apps.form.lib.TextField",
                "properties": {
                    "encryption": "",
                    "id": "pedido_banco",
                    "label": "Pedido Banco",
                    "maxlength": "",
                    "placeholder": "",
                    "readonly": "",
                    "readonlyLabel": "",
                    "size": "",
                    "storeNumeric": "",
                    "style": "",
                    "validator": {
                        "className": "",
                        "properties": {}
                    },
                    "value": "",
                    "workflowVariable": ""
                }
            }],
            "properties": {"width": "100%"}
        }],
        "properties": {
            "id": "section1",
            "label": "Section"
        }
    }],
    "properties": {
        "description": "",
        "id": "comparacaoProcessosDistrates",
        "loadBinder": {
            "className": "",
            "properties": {}
        },
        "name": "Distrates - Comparação de Processos",
        "noPermissionMessage": "",
        "permission": {
            "className": "",
            "properties": {}
        },
        "postProcessor": {
            "className": "",
            "properties": {}
        },
        "postProcessorRunOn": "create",
        "storeBinder": {
            "className": "org.joget.apps.form.lib.BeanShellFormBinder",
            "properties": {
                "autoHandleFiles": "",
                "autoHandleWorkflowVariable": "true",
                "cacheInterval": "",
                "script": "import java.util.Map;\r\nimport java.util.ArrayList;\r\nimport java.util.Arrays;\r\nimport java.util.Collection;\r\nimport org.joget.apps.app.model.AppDefinition;\r\nimport org.joget.apps.app.service.AppService;\r\nimport org.joget.apps.app.service.AppUtil;\r\nimport org.joget.workflow.model.service.WorkflowManager;\r\nimport org.joget.workflow.model.WorkflowAssignment;\r\nimport org.joget.workflow.model.WorkflowProcess;\r\nimport org.joget.workflow.model.WorkflowProcessResult;\r\nimport org.joget.workflow.model.WorkflowActivity;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.service.FormUtil;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.apps.form.model.FormRow;\r\nimport org.joget.apps.form.model.FormRowSet;\r\nimport org.joget.commons.util.UuidGenerator;\r\nimport org.joget.commons.util.LogUtil;\r\nimport org.joget.workflow.model.service.*;\r\nimport java.sql.Connection;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport javax.sql.DataSource;\r\nimport java.time.LocalDateTime; \r\nimport java.time.format.DateTimeFormatter;\r\nimport java.time.DayOfWeek;\r\nimport javax.swing.JOptionPane.showMessageDialog;\r\nimport org.joget.plugin.base.Plugin;\r\nimport org.joget.plugin.base.PluginManager;\r\n\r\npublic FormRowSet storeData(Element element, FormRowSet rows, FormData formData) {\r\n    AppService appService = (AppService) AppUtil.getApplicationContext().getBean(\"appService\");\r\n    WorkflowManager workflowManager = (WorkflowManager) AppUtil.getApplicationContext().getBean(\"workflowManager\");\r\n    AppDefinition appDef = AppUtil.getCurrentAppDefinition();\r\n        \r\n    try{\r\n        //check for empty data\r\n        if (rows == null || rows.isEmpty()) {\r\n            return rows;\r\n        }\r\n        \r\n        //get value from form to set workflow variables\r\n        FormRow originalRow = rows.get(0);\r\n        String pedidoBanco = originalRow.getProperty(\"pedido_banco\");\r\n\r\n        Connection con = null;\r\n        PreparedStatement stmt = null;\r\n        ResultSet rs = null;\r\n        try{\r\n            DataSource ds = (DataSource)AppUtil.getApplicationContext().getBean(\"setupDataSource\");\r\n            con = ds.getConnection();\r\n            \r\n            if(!con.isClosed()){\r\n                String queryGetProcesso = \"SELECT id FROM app_fd_detalhe_proce_dist WHERE c_num_pedido = ?\";\r\n                stmt = con.prepareStatement(queryGetProcesso);\r\n                stmt.setObject(1, pedidoBanco);\r\n                rs = stmt.executeQuery();\r\n                if (rs.next()) {\r\n                    LogUtil.info(\"Existe processo\", \"AAAAAAAA\");\r\n                    String idDetalhe = rs.getObject(\"id\").toString();\r\n                    String queryUpdate = \"UPDATE app_fd_detalhe_proce_dis SET c_verificaco_banco= ? WHERE id = ?\";\r\n                    stmt = con.prepareStatement(queryUpdate);\r\n                    stmt.setObject(1, idDetalhe);\r\n                    stmt.executeQuery();\r\n                }\r\n            }\r\n        }catch(Exception e){\r\n            LogUtil.error(\"Distrates - Comparação de processos\", e, \"BeanShell Store Binder\");\r\n        }finally{\r\n            try{\r\n                if(rs != null){\r\n                rs.close();\r\n                }\r\n                if(stmt != null){\r\n                    stmt.close();\r\n                }\r\n                if(con != null && !con.isClosed()) {\r\n                    con.close();\r\n                }\r\n            }catch(Exception e){\r\n                LogUtil.error(\"Distrates - Comparação de processos\", e, \"BeanShell Store Binder\");\r\n            }\r\n            \r\n        }\r\n      \r\n     \r\n    return rows;\r\n}\r\n\r\n//call execute method with injected variable\r\nreturn storeData(element, rows, formData);",
                "useAjax": ""
            }
        },
        "tableName": "detalhe_proce_dist"
    }
}